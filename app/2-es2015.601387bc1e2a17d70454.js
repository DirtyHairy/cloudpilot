(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{bucj:function(t,e,r){"use strict";r.d(e,"b",function(){return D}),r.d(e,"a",function(){return P});var n,o=r("mrSG"),i=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var e,r,o=void 0!==(t=t||{})?t:{};o.ready=new Promise(function(t,n){e=t,r=n});var i,a={};for(i in o)o.hasOwnProperty(i)&&(a[i]=o[i]);var s,u,c=[],l="./this.program",p=function(t,e){throw e};s="object"==typeof window,u="function"==typeof importScripts,"object"==typeof process&&"object"==typeof process.versions&&process;var d,f,h="";(s||u)&&(u?h=self.location.href:"undefined"!=typeof document&&document.currentScript&&(h=document.currentScript.src),n&&(h=n),h=0!==h.indexOf("blob:")?h.substr(0,h.lastIndexOf("/")+1):"",d=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},u&&(f=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}));var m,_,y,g=o.print||console.log.bind(console),v=o.printErr||console.warn.bind(console);for(i in a)a.hasOwnProperty(i)&&(o[i]=a[i]);a=null,o.arguments&&(c=o.arguments),o.thisProgram&&(l=o.thisProgram),o.quit&&(p=o.quit),o.wasmBinary&&(m=o.wasmBinary),o.noExitRuntime&&(_=o.noExitRuntime),"object"!=typeof WebAssembly&&V("no native wasm support detected");var w=!1;function b(t,e){t||V("Assertion failed: "+e)}var E,S,k,D,P="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function F(t,e,r){for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.subarray&&P)return P.decode(t.subarray(e,o));for(var i="";e<o;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var u=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&t[e++])<65536)i+=String.fromCharCode(a);else{var c=a-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&a)<<6|s)}else i+=String.fromCharCode(a)}return i}function M(t,e){return t?F(k,t,e):""}function I(t,e,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a)),s<=127){if(r>=i)break;e[r++]=s}else if(s<=2047){if(r+1>=i)break;e[r++]=192|s>>6,e[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;e[r++]=224|s>>12,e[r++]=128|s>>6&63,e[r++]=128|63&s}else{if(r+3>=i)break;e[r++]=240|s>>18,e[r++]=128|s>>12&63,e[r++]=128|s>>6&63,e[r++]=128|63&s}}return e[r]=0,r-o}function C(t,e,r){return I(t,k,e,r)}function R(t){for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++r)),n<=127?++e:e+=n<=2047?2:n<=65535?3:4}return e}function A(t){var e=R(t)+1,r=vt(e);return r&&I(t,S,r,e),r}function x(t,e){S.set(t,e)}function O(t){E=t,o.HEAP8=S=new Int8Array(t),o.HEAP16=new Int16Array(t),o.HEAP32=D=new Int32Array(t),o.HEAPU8=k=new Uint8Array(t),o.HEAPU16=new Uint16Array(t),o.HEAPU32=new Uint32Array(t),o.HEAPF32=new Float32Array(t),o.HEAPF64=new Float64Array(t)}var z,B=[],j=[],G=[],L=[],T=0,N=null,U=null;function H(t){T++,o.monitorRunDependencies&&o.monitorRunDependencies(T)}function q(t){if(T--,o.monitorRunDependencies&&o.monitorRunDependencies(T),0==T&&(null!==N&&(clearInterval(N),N=null),U)){var e=U;U=null,e()}}function V(t){o.onAbort&&o.onAbort(t),v(t+=""),w=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw r(e),e}function W(t){return e=t,r="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(r):0===e.indexOf(r);var e,r}o.preloadedImages={},o.preloadedAudios={};var Y,Q,X,Z,J="cloudpilot_web.wasm";function $(t){try{if(t==J&&m)return new Uint8Array(m);if(f)return f(t);throw"both async and sync fetching of the wasm failed"}catch(v){V(v)}}function K(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var r=e.func;"number"==typeof r?void 0===e.arg?z.get(r)():z.get(r)(e.arg):r(void 0===e.arg?null:e.arg)}else e(o)}}function tt(t){try{return y.grow(t-E.byteLength+65535>>>16),O(y.buffer),1}catch(e){}}W(J)||(Y=J,J=o.locateFile?o.locateFile(Y,h):h+Y),Z=function(){return performance.now()};var et={};function rt(){if(!rt.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var e in et)t[e]=et[e];var r=[];for(var e in t)r.push(e+"="+t[e]);rt.strings=r}return rt.strings}var nt={splitPath:function(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)},normalizeArray:function(t,e){for(var r=0,n=t.length-1;n>=0;n--){var o=t[n];"."===o?t.splice(n,1):".."===o?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r;r--)t.unshift("..");return t},normalize:function(t){var e="/"===t.charAt(0),r="/"===t.substr(-1);return(t=nt.normalizeArray(t.split("/").filter(function(t){return!!t}),!e).join("/"))||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},dirname:function(t){var e=nt.splitPath(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(t){if("/"===t)return"/";var e=(t=(t=nt.normalize(t)).replace(/\/$/,"")).lastIndexOf("/");return-1===e?t:t.substr(e+1)},extname:function(t){return nt.splitPath(t)[3]},join:function(){var t=Array.prototype.slice.call(arguments,0);return nt.normalize(t.join("/"))},join2:function(t,e){return nt.normalize(t+"/"+e)}},ot={resolve:function(){for(var t="",e=!1,r=arguments.length-1;r>=-1&&!e;r--){var n=r>=0?arguments[r]:st.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,e="/"===n.charAt(0)}return(e?"/":"")+(t=nt.normalizeArray(t.split("/").filter(function(t){return!!t}),!e).join("/"))||"."},relative:function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=ot.resolve(t).substr(1),e=ot.resolve(e).substr(1);for(var n=r(t.split("/")),o=r(e.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}var u=[];for(s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},it={ttys:[],init:function(){},shutdown:function(){},register:function(t,e){it.ttys[t]={input:[],output:[],ops:e},st.registerDevice(t,it.stream_ops)},stream_ops:{open:function(t){var e=it.ttys[t.node.rdev];if(!e)throw new st.ErrnoError(43);t.tty=e,t.seekable=!1},close:function(t){t.tty.ops.flush(t.tty)},flush:function(t){t.tty.ops.flush(t.tty)},read:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.get_char)throw new st.ErrnoError(60);for(var i=0,a=0;a<n;a++){var s;try{s=t.tty.ops.get_char(t.tty)}catch(u){throw new st.ErrnoError(29)}if(void 0===s&&0===i)throw new st.ErrnoError(6);if(null==s)break;i++,e[r+a]=s}return i&&(t.node.timestamp=Date.now()),i},write:function(t,e,r,n,o){if(!t.tty||!t.tty.ops.put_char)throw new st.ErrnoError(60);try{for(var i=0;i<n;i++)t.tty.ops.put_char(t.tty,e[r+i])}catch(a){throw new st.ErrnoError(29)}return n&&(t.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(t){if(!t.input.length){var e=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n"),!e)return null;t.input=mt(e,!0)}return t.input.shift()},put_char:function(t,e){null===e||10===e?(g(F(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(g(F(t.output,0)),t.output=[])}},default_tty1_ops:{put_char:function(t,e){null===e||10===e?(v(F(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(v(F(t.output,0)),t.output=[])}}},at={ops_table:null,mount:function(t){return at.createNode(null,"/",16895,0)},createNode:function(t,e,r,n){if(st.isBlkdev(r)||st.isFIFO(r))throw new st.ErrnoError(63);at.ops_table||(at.ops_table={dir:{node:{getattr:at.node_ops.getattr,setattr:at.node_ops.setattr,lookup:at.node_ops.lookup,mknod:at.node_ops.mknod,rename:at.node_ops.rename,unlink:at.node_ops.unlink,rmdir:at.node_ops.rmdir,readdir:at.node_ops.readdir,symlink:at.node_ops.symlink},stream:{llseek:at.stream_ops.llseek}},file:{node:{getattr:at.node_ops.getattr,setattr:at.node_ops.setattr},stream:{llseek:at.stream_ops.llseek,read:at.stream_ops.read,write:at.stream_ops.write,allocate:at.stream_ops.allocate,mmap:at.stream_ops.mmap,msync:at.stream_ops.msync}},link:{node:{getattr:at.node_ops.getattr,setattr:at.node_ops.setattr,readlink:at.node_ops.readlink},stream:{}},chrdev:{node:{getattr:at.node_ops.getattr,setattr:at.node_ops.setattr},stream:st.chrdev_stream_ops}});var o=st.createNode(t,e,r,n);return st.isDir(o.mode)?(o.node_ops=at.ops_table.dir.node,o.stream_ops=at.ops_table.dir.stream,o.contents={}):st.isFile(o.mode)?(o.node_ops=at.ops_table.file.node,o.stream_ops=at.ops_table.file.stream,o.usedBytes=0,o.contents=null):st.isLink(o.mode)?(o.node_ops=at.ops_table.link.node,o.stream_ops=at.ops_table.link.stream):st.isChrdev(o.mode)&&(o.node_ops=at.ops_table.chrdev.node,o.stream_ops=at.ops_table.chrdev.stream),o.timestamp=Date.now(),t&&(t.contents[e]=o),o},getFileDataAsRegularArray:function(t){if(t.contents&&t.contents.subarray){for(var e=[],r=0;r<t.usedBytes;++r)e.push(t.contents[r]);return e}return t.contents},getFileDataAsTypedArray:function(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array(0)},expandFileStorage:function(t,e){var r=t.contents?t.contents.length:0;if(!(r>=e)){e=Math.max(e,r*(r<1048576?2:1.125)>>>0),0!=r&&(e=Math.max(e,256));var n=t.contents;t.contents=new Uint8Array(e),t.usedBytes>0&&t.contents.set(n.subarray(0,t.usedBytes),0)}},resizeFileStorage:function(t,e){if(t.usedBytes!=e){if(0==e)return t.contents=null,void(t.usedBytes=0);if(!t.contents||t.contents.subarray){var r=t.contents;return t.contents=new Uint8Array(e),r&&t.contents.set(r.subarray(0,Math.min(e,t.usedBytes))),void(t.usedBytes=e)}if(t.contents||(t.contents=[]),t.contents.length>e)t.contents.length=e;else for(;t.contents.length<e;)t.contents.push(0);t.usedBytes=e}},node_ops:{getattr:function(t){var e={};return e.dev=st.isChrdev(t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,e.size=st.isDir(t.mode)?4096:st.isFile(t.mode)?t.usedBytes:st.isLink(t.mode)?t.link.length:0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&at.resizeFileStorage(t,e.size)},lookup:function(t,e){throw st.genericErrors[44]},mknod:function(t,e,r,n){return at.createNode(t,e,r,n)},rename:function(t,e,r){if(st.isDir(t.mode)){var n;try{n=st.lookupNode(e,r)}catch(i){}if(n)for(var o in n.contents)throw new st.ErrnoError(55)}delete t.parent.contents[t.name],t.name=r,e.contents[r]=t,t.parent=e},unlink:function(t,e){delete t.contents[e]},rmdir:function(t,e){var r=st.lookupNode(t,e);for(var n in r.contents)throw new st.ErrnoError(55);delete t.contents[e]},readdir:function(t){var e=[".",".."];for(var r in t.contents)t.contents.hasOwnProperty(r)&&e.push(r);return e},symlink:function(t,e,r){var n=at.createNode(t,e,41471,0);return n.link=r,n},readlink:function(t){if(!st.isLink(t.mode))throw new st.ErrnoError(28);return t.link}},stream_ops:{read:function(t,e,r,n,o){var i=t.node.contents;if(o>=t.node.usedBytes)return 0;var a=Math.min(t.node.usedBytes-o,n);if(a>8&&i.subarray)e.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)e[r+s]=i[o+s];return a},write:function(t,e,r,n,o,i){if(e.buffer===S.buffer&&(i=!1),!n)return 0;var a=t.node;if(a.timestamp=Date.now(),e.subarray&&(!a.contents||a.contents.subarray)){if(i)return a.contents=e.subarray(r,r+n),a.usedBytes=n,n;if(0===a.usedBytes&&0===o)return a.contents=e.slice(r,r+n),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(e.subarray(r,r+n),o),n}if(at.expandFileStorage(a,o+n),a.contents.subarray&&e.subarray)a.contents.set(e.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=e[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(t,e,r){var n=e;if(1===r?n+=t.position:2===r&&st.isFile(t.node.mode)&&(n+=t.node.usedBytes),n<0)throw new st.ErrnoError(28);return n},allocate:function(t,e,r){at.expandFileStorage(t.node,e+r),t.node.usedBytes=Math.max(t.node.usedBytes,e+r)},mmap:function(t,e,r,n,o,i){if(b(0===e),!st.isFile(t.node.mode))throw new st.ErrnoError(43);var a,s,u=t.node.contents;if(2&i||u.buffer!==E){if((n>0||n+r<u.length)&&(u=u.subarray?u.subarray(n,n+r):Array.prototype.slice.call(u,n,n+r)),s=!0,!(a=function(t){for(var e=function(t,e){return e||(e=16),Math.ceil(t/e)*e}(t,16384),r=vt(e);t<e;)S[r+t++]=0;return r}(r)))throw new st.ErrnoError(48);S.set(u,a)}else s=!1,a=u.byteOffset;return{ptr:a,allocated:s}},msync:function(t,e,r,n,o){if(!st.isFile(t.node.mode))throw new st.ErrnoError(43);return 2&o||at.stream_ops.write(t,e,0,n,r,!1),0}}},st={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(t,e){if(e=e||{},!(t=ot.resolve(st.cwd(),t)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===e[n]&&(e[n]=r[n]);if(e.recurse_count>8)throw new st.ErrnoError(32);for(var o=nt.normalizeArray(t.split("/").filter(function(t){return!!t}),!1),i=st.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&e.parent)break;if(i=st.lookupNode(i,o[s]),a=nt.join2(a,o[s]),st.isMountpoint(i)&&(!u||u&&e.follow_mount)&&(i=i.mounted.root),!u||e.follow)for(var c=0;st.isLink(i.mode);){var l=st.readlink(a);if(a=ot.resolve(nt.dirname(a),l),i=st.lookupPath(a,{recurse_count:e.recurse_count}).node,c++>40)throw new st.ErrnoError(32)}}return{path:a,node:i}},getPath:function(t){for(var e;;){if(st.isRoot(t)){var r=t.mount.mountpoint;return e?"/"!==r[r.length-1]?r+"/"+e:r+e:r}e=e?t.name+"/"+e:t.name,t=t.parent}},hashName:function(t,e){for(var r=0,n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)|0;return(t+r>>>0)%st.nameTable.length},hashAddNode:function(t){var e=st.hashName(t.parent.id,t.name);t.name_next=st.nameTable[e],st.nameTable[e]=t},hashRemoveNode:function(t){var e=st.hashName(t.parent.id,t.name);if(st.nameTable[e]===t)st.nameTable[e]=t.name_next;else for(var r=st.nameTable[e];r;){if(r.name_next===t){r.name_next=t.name_next;break}r=r.name_next}},lookupNode:function(t,e){var r=st.mayLookup(t);if(r)throw new st.ErrnoError(r,t);for(var n=st.hashName(t.id,e),o=st.nameTable[n];o;o=o.name_next)if(o.parent.id===t.id&&o.name===e)return o;return st.lookup(t,e)},createNode:function(t,e,r,n){var o=new st.FSNode(t,e,r,n);return st.hashAddNode(o),o},destroyNode:function(t){st.hashRemoveNode(t)},isRoot:function(t){return t===t.parent},isMountpoint:function(t){return!!t.mounted},isFile:function(t){return 32768==(61440&t)},isDir:function(t){return 16384==(61440&t)},isLink:function(t){return 40960==(61440&t)},isChrdev:function(t){return 8192==(61440&t)},isBlkdev:function(t){return 24576==(61440&t)},isFIFO:function(t){return 4096==(61440&t)},isSocket:function(t){return 49152==(49152&t)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(t){var e=st.flagModes[t];if(void 0===e)throw new Error("Unknown file open mode: "+t);return e},flagsToPermissionString:function(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e},nodePermissions:function(t,e){return st.ignorePermissions||(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:2},mayLookup:function(t){return st.nodePermissions(t,"x")||(t.node_ops.lookup?0:2)},mayCreate:function(t,e){try{return st.lookupNode(t,e),20}catch(r){}return st.nodePermissions(t,"wx")},mayDelete:function(t,e,r){var n;try{n=st.lookupNode(t,e)}catch(i){return i.errno}var o=st.nodePermissions(t,"wx");if(o)return o;if(r){if(!st.isDir(n.mode))return 54;if(st.isRoot(n)||st.getPath(n)===st.cwd())return 10}else if(st.isDir(n.mode))return 31;return 0},mayOpen:function(t,e){return t?st.isLink(t.mode)?32:st.isDir(t.mode)&&("r"!==st.flagsToPermissionString(e)||512&e)?31:st.nodePermissions(t,st.flagsToPermissionString(e)):44},MAX_OPEN_FDS:4096,nextfd:function(t,e){e=e||st.MAX_OPEN_FDS;for(var r=t=t||0;r<=e;r++)if(!st.streams[r])return r;throw new st.ErrnoError(33)},getStream:function(t){return st.streams[t]},createStream:function(t,e,r){st.FSStream||(st.FSStream=function(){},st.FSStream.prototype={object:{get:function(){return this.node},set:function(t){this.node=t}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var n=new st.FSStream;for(var o in t)n[o]=t[o];t=n;var i=st.nextfd(e,r);return t.fd=i,st.streams[i]=t,t},closeStream:function(t){st.streams[t]=null},chrdev_stream_ops:{open:function(t){var e=st.getDevice(t.node.rdev);t.stream_ops=e.stream_ops,t.stream_ops.open&&t.stream_ops.open(t)},llseek:function(){throw new st.ErrnoError(70)}},major:function(t){return t>>8},minor:function(t){return 255&t},makedev:function(t,e){return t<<8|e},registerDevice:function(t,e){st.devices[t]={stream_ops:e}},getDevice:function(t){return st.devices[t]},getMounts:function(t){for(var e=[],r=[t];r.length;){var n=r.pop();e.push(n),r.push.apply(r,n.mounts)}return e},syncfs:function(t,e){"function"==typeof t&&(e=t,t=!1),st.syncFSRequests++,st.syncFSRequests>1&&v("warning: "+st.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=st.getMounts(st.root.mount),n=0;function o(t){return st.syncFSRequests--,e(t)}function i(t){if(t)return i.errored?void 0:(i.errored=!0,o(t));++n>=r.length&&o(null)}r.forEach(function(e){if(!e.type.syncfs)return i(null);e.type.syncfs(e,t,i)})},mount:function(t,e,r){var n,o="/"===r,i=!r;if(o&&st.root)throw new st.ErrnoError(10);if(!o&&!i){var a=st.lookupPath(r,{follow_mount:!1});if(r=a.path,st.isMountpoint(n=a.node))throw new st.ErrnoError(10);if(!st.isDir(n.mode))throw new st.ErrnoError(54)}var s={type:t,opts:e,mountpoint:r,mounts:[]},u=t.mount(s);return u.mount=s,s.root=u,o?st.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(t){var e=st.lookupPath(t,{follow_mount:!1});if(!st.isMountpoint(e.node))throw new st.ErrnoError(28);var r=e.node,n=r.mounted,o=st.getMounts(n);Object.keys(st.nameTable).forEach(function(t){for(var e=st.nameTable[t];e;){var r=e.name_next;-1!==o.indexOf(e.mount)&&st.destroyNode(e),e=r}}),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(t,e){return t.node_ops.lookup(t,e)},mknod:function(t,e,r){var n=st.lookupPath(t,{parent:!0}).node,o=nt.basename(t);if(!o||"."===o||".."===o)throw new st.ErrnoError(28);var i=st.mayCreate(n,o);if(i)throw new st.ErrnoError(i);if(!n.node_ops.mknod)throw new st.ErrnoError(63);return n.node_ops.mknod(n,o,e,r)},create:function(t,e){return e=void 0!==e?e:438,e&=4095,st.mknod(t,e|=32768,0)},mkdir:function(t,e){return e=void 0!==e?e:511,e&=1023,st.mknod(t,e|=16384,0)},mkdirTree:function(t,e){for(var r=t.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{st.mkdir(n,e)}catch(i){if(20!=i.errno)throw i}}},mkdev:function(t,e,r){return void 0===r&&(r=e,e=438),st.mknod(t,e|=8192,r)},symlink:function(t,e){if(!ot.resolve(t))throw new st.ErrnoError(44);var r=st.lookupPath(e,{parent:!0}).node;if(!r)throw new st.ErrnoError(44);var n=nt.basename(e),o=st.mayCreate(r,n);if(o)throw new st.ErrnoError(o);if(!r.node_ops.symlink)throw new st.ErrnoError(63);return r.node_ops.symlink(r,n,t)},rename:function(t,e){var r,n,o=nt.dirname(t),i=nt.dirname(e),a=nt.basename(t),s=nt.basename(e);if(r=st.lookupPath(t,{parent:!0}).node,n=st.lookupPath(e,{parent:!0}).node,!r||!n)throw new st.ErrnoError(44);if(r.mount!==n.mount)throw new st.ErrnoError(75);var u,c=st.lookupNode(r,a),l=ot.relative(t,i);if("."!==l.charAt(0))throw new st.ErrnoError(28);if("."!==(l=ot.relative(e,o)).charAt(0))throw new st.ErrnoError(55);try{u=st.lookupNode(n,s)}catch(f){}if(c!==u){var p=st.isDir(c.mode),d=st.mayDelete(r,a,p);if(d)throw new st.ErrnoError(d);if(d=u?st.mayDelete(n,s,p):st.mayCreate(n,s))throw new st.ErrnoError(d);if(!r.node_ops.rename)throw new st.ErrnoError(63);if(st.isMountpoint(c)||u&&st.isMountpoint(u))throw new st.ErrnoError(10);if(n!==r&&(d=st.nodePermissions(r,"w")))throw new st.ErrnoError(d);try{st.trackingDelegate.willMovePath&&st.trackingDelegate.willMovePath(t,e)}catch(f){v("FS.trackingDelegate['willMovePath']('"+t+"', '"+e+"') threw an exception: "+f.message)}st.hashRemoveNode(c);try{r.node_ops.rename(c,n,s)}catch(f){throw f}finally{st.hashAddNode(c)}try{st.trackingDelegate.onMovePath&&st.trackingDelegate.onMovePath(t,e)}catch(f){v("FS.trackingDelegate['onMovePath']('"+t+"', '"+e+"') threw an exception: "+f.message)}}},rmdir:function(t){var e=st.lookupPath(t,{parent:!0}).node,r=nt.basename(t),n=st.lookupNode(e,r),o=st.mayDelete(e,r,!0);if(o)throw new st.ErrnoError(o);if(!e.node_ops.rmdir)throw new st.ErrnoError(63);if(st.isMountpoint(n))throw new st.ErrnoError(10);try{st.trackingDelegate.willDeletePath&&st.trackingDelegate.willDeletePath(t)}catch(i){v("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+i.message)}e.node_ops.rmdir(e,r),st.destroyNode(n);try{st.trackingDelegate.onDeletePath&&st.trackingDelegate.onDeletePath(t)}catch(i){v("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+i.message)}},readdir:function(t){var e=st.lookupPath(t,{follow:!0}).node;if(!e.node_ops.readdir)throw new st.ErrnoError(54);return e.node_ops.readdir(e)},unlink:function(t){var e=st.lookupPath(t,{parent:!0}).node,r=nt.basename(t),n=st.lookupNode(e,r),o=st.mayDelete(e,r,!1);if(o)throw new st.ErrnoError(o);if(!e.node_ops.unlink)throw new st.ErrnoError(63);if(st.isMountpoint(n))throw new st.ErrnoError(10);try{st.trackingDelegate.willDeletePath&&st.trackingDelegate.willDeletePath(t)}catch(i){v("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+i.message)}e.node_ops.unlink(e,r),st.destroyNode(n);try{st.trackingDelegate.onDeletePath&&st.trackingDelegate.onDeletePath(t)}catch(i){v("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+i.message)}},readlink:function(t){var e=st.lookupPath(t).node;if(!e)throw new st.ErrnoError(44);if(!e.node_ops.readlink)throw new st.ErrnoError(28);return ot.resolve(st.getPath(e.parent),e.node_ops.readlink(e))},stat:function(t,e){var r=st.lookupPath(t,{follow:!e}).node;if(!r)throw new st.ErrnoError(44);if(!r.node_ops.getattr)throw new st.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(t){return st.stat(t,!0)},chmod:function(t,e,r){var n;if(!(n="string"==typeof t?st.lookupPath(t,{follow:!r}).node:t).node_ops.setattr)throw new st.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&e|-4096&n.mode,timestamp:Date.now()})},lchmod:function(t,e){st.chmod(t,e,!0)},fchmod:function(t,e){var r=st.getStream(t);if(!r)throw new st.ErrnoError(8);st.chmod(r.node,e)},chown:function(t,e,r,n){var o;if(!(o="string"==typeof t?st.lookupPath(t,{follow:!n}).node:t).node_ops.setattr)throw new st.ErrnoError(63);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(t,e,r){st.chown(t,e,r,!0)},fchown:function(t,e,r){var n=st.getStream(t);if(!n)throw new st.ErrnoError(8);st.chown(n.node,e,r)},truncate:function(t,e){if(e<0)throw new st.ErrnoError(28);var r;if(!(r="string"==typeof t?st.lookupPath(t,{follow:!0}).node:t).node_ops.setattr)throw new st.ErrnoError(63);if(st.isDir(r.mode))throw new st.ErrnoError(31);if(!st.isFile(r.mode))throw new st.ErrnoError(28);var n=st.nodePermissions(r,"w");if(n)throw new st.ErrnoError(n);r.node_ops.setattr(r,{size:e,timestamp:Date.now()})},ftruncate:function(t,e){var r=st.getStream(t);if(!r)throw new st.ErrnoError(8);if(0==(2097155&r.flags))throw new st.ErrnoError(28);st.truncate(r.node,e)},utime:function(t,e,r){var n=st.lookupPath(t,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(e,r)})},open:function(t,e,r,n,i){if(""===t)throw new st.ErrnoError(44);var a;if(r=void 0===r?438:r,r=64&(e="string"==typeof e?st.modeStringToFlags(e):e)?4095&r|32768:0,"object"==typeof t)a=t;else{t=nt.normalize(t);try{a=st.lookupPath(t,{follow:!(131072&e)}).node}catch(p){}}var s=!1;if(64&e)if(a){if(128&e)throw new st.ErrnoError(20)}else a=st.mknod(t,r,0),s=!0;if(!a)throw new st.ErrnoError(44);if(st.isChrdev(a.mode)&&(e&=-513),65536&e&&!st.isDir(a.mode))throw new st.ErrnoError(54);if(!s){var u=st.mayOpen(a,e);if(u)throw new st.ErrnoError(u)}512&e&&st.truncate(a,0),e&=-131713;var c=st.createStream({node:a,path:st.getPath(a),flags:e,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1},n,i);c.stream_ops.open&&c.stream_ops.open(c),!o.logReadFiles||1&e||(st.readFiles||(st.readFiles={}),t in st.readFiles||(st.readFiles[t]=1,v("FS.trackingDelegate error on read file: "+t)));try{if(st.trackingDelegate.onOpenFile){var l=0;1!=(2097155&e)&&(l|=st.tracking.openFlags.READ),0!=(2097155&e)&&(l|=st.tracking.openFlags.WRITE),st.trackingDelegate.onOpenFile(t,l)}}catch(p){v("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+p.message)}return c},close:function(t){if(st.isClosed(t))throw new st.ErrnoError(8);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(e){throw e}finally{st.closeStream(t.fd)}t.fd=null},isClosed:function(t){return null===t.fd},llseek:function(t,e,r){if(st.isClosed(t))throw new st.ErrnoError(8);if(!t.seekable||!t.stream_ops.llseek)throw new st.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new st.ErrnoError(28);return t.position=t.stream_ops.llseek(t,e,r),t.ungotten=[],t.position},read:function(t,e,r,n,o){if(n<0||o<0)throw new st.ErrnoError(28);if(st.isClosed(t))throw new st.ErrnoError(8);if(1==(2097155&t.flags))throw new st.ErrnoError(8);if(st.isDir(t.node.mode))throw new st.ErrnoError(31);if(!t.stream_ops.read)throw new st.ErrnoError(28);var i=void 0!==o;if(i){if(!t.seekable)throw new st.ErrnoError(70)}else o=t.position;var a=t.stream_ops.read(t,e,r,n,o);return i||(t.position+=a),a},write:function(t,e,r,n,o,i){if(n<0||o<0)throw new st.ErrnoError(28);if(st.isClosed(t))throw new st.ErrnoError(8);if(0==(2097155&t.flags))throw new st.ErrnoError(8);if(st.isDir(t.node.mode))throw new st.ErrnoError(31);if(!t.stream_ops.write)throw new st.ErrnoError(28);t.seekable&&1024&t.flags&&st.llseek(t,0,2);var a=void 0!==o;if(a){if(!t.seekable)throw new st.ErrnoError(70)}else o=t.position;var s=t.stream_ops.write(t,e,r,n,o,i);a||(t.position+=s);try{t.path&&st.trackingDelegate.onWriteToFile&&st.trackingDelegate.onWriteToFile(t.path)}catch(u){v("FS.trackingDelegate['onWriteToFile']('"+t.path+"') threw an exception: "+u.message)}return s},allocate:function(t,e,r){if(st.isClosed(t))throw new st.ErrnoError(8);if(e<0||r<=0)throw new st.ErrnoError(28);if(0==(2097155&t.flags))throw new st.ErrnoError(8);if(!st.isFile(t.node.mode)&&!st.isDir(t.node.mode))throw new st.ErrnoError(43);if(!t.stream_ops.allocate)throw new st.ErrnoError(138);t.stream_ops.allocate(t,e,r)},mmap:function(t,e,r,n,o,i){if(0!=(2&o)&&0==(2&i)&&2!=(2097155&t.flags))throw new st.ErrnoError(2);if(1==(2097155&t.flags))throw new st.ErrnoError(2);if(!t.stream_ops.mmap)throw new st.ErrnoError(43);return t.stream_ops.mmap(t,e,r,n,o,i)},msync:function(t,e,r,n,o){return t&&t.stream_ops.msync?t.stream_ops.msync(t,e,r,n,o):0},munmap:function(t){return 0},ioctl:function(t,e,r){if(!t.stream_ops.ioctl)throw new st.ErrnoError(59);return t.stream_ops.ioctl(t,e,r)},readFile:function(t,e){if((e=e||{}).flags=e.flags||0,e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var r,n=st.open(t,e.flags),o=st.stat(t).size,i=new Uint8Array(o);return st.read(n,i,0,o,0),"utf8"===e.encoding?r=F(i,0):"binary"===e.encoding&&(r=i),st.close(n),r},writeFile:function(t,e,r){(r=r||{}).flags=r.flags||577;var n=st.open(t,r.flags,r.mode);if("string"==typeof e){var o=new Uint8Array(R(e)+1),i=I(e,o,0,o.length);st.write(n,o,0,i,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");st.write(n,e,0,e.byteLength,void 0,r.canOwn)}st.close(n)},cwd:function(){return st.currentPath},chdir:function(t){var e=st.lookupPath(t,{follow:!0});if(null===e.node)throw new st.ErrnoError(44);if(!st.isDir(e.node.mode))throw new st.ErrnoError(54);var r=st.nodePermissions(e.node,"x");if(r)throw new st.ErrnoError(r);st.currentPath=e.path},createDefaultDirectories:function(){st.mkdir("/tmp"),st.mkdir("/home"),st.mkdir("/home/web_user")},createDefaultDevices:function(){st.mkdir("/dev"),st.registerDevice(st.makedev(1,3),{read:function(){return 0},write:function(t,e,r,n,o){return n}}),st.mkdev("/dev/null",st.makedev(1,3)),it.register(st.makedev(5,0),it.default_tty_ops),it.register(st.makedev(6,0),it.default_tty1_ops),st.mkdev("/dev/tty",st.makedev(5,0)),st.mkdev("/dev/tty1",st.makedev(6,0));var t=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return function(){return crypto.getRandomValues(t),t[0]}}return function(){V("randomDevice")}}();st.createDevice("/dev","random",t),st.createDevice("/dev","urandom",t),st.mkdir("/dev/shm"),st.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){st.mkdir("/proc"),st.mkdir("/proc/self"),st.mkdir("/proc/self/fd"),st.mount({mount:function(){var t=st.createNode("/proc/self","fd",16895,73);return t.node_ops={lookup:function(t,e){var r=st.getStream(+e);if(!r)throw new st.ErrnoError(8);var n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return r.path}}};return n.parent=n,n}},t}},{},"/proc/self/fd")},createStandardStreams:function(){o.stdin?st.createDevice("/dev","stdin",o.stdin):st.symlink("/dev/tty","/dev/stdin"),o.stdout?st.createDevice("/dev","stdout",null,o.stdout):st.symlink("/dev/tty","/dev/stdout"),o.stderr?st.createDevice("/dev","stderr",null,o.stderr):st.symlink("/dev/tty1","/dev/stderr"),st.open("/dev/stdin",0),st.open("/dev/stdout",1),st.open("/dev/stderr",1)},ensureErrnoError:function(){st.ErrnoError||(st.ErrnoError=function(t,e){this.node=e,this.setErrno=function(t){this.errno=t},this.setErrno(t),this.message="FS error"},st.ErrnoError.prototype=new Error,st.ErrnoError.prototype.constructor=st.ErrnoError,[44].forEach(function(t){st.genericErrors[t]=new st.ErrnoError(t),st.genericErrors[t].stack="<generic error, no stack>"}))},staticInit:function(){st.ensureErrnoError(),st.nameTable=new Array(4096),st.mount(at,{},"/"),st.createDefaultDirectories(),st.createDefaultDevices(),st.createSpecialDirectories(),st.filesystems={MEMFS:at}},init:function(t,e,r){st.init.initialized=!0,st.ensureErrnoError(),o.stdin=t||o.stdin,o.stdout=e||o.stdout,o.stderr=r||o.stderr,st.createStandardStreams()},quit:function(){st.init.initialized=!1;var t=o._fflush;t&&t(0);for(var e=0;e<st.streams.length;e++){var r=st.streams[e];r&&st.close(r)}},getMode:function(t,e){var r=0;return t&&(r|=365),e&&(r|=146),r},findObject:function(t,e){var r=st.analyzePath(t,e);return r.exists?r.object:null},analyzePath:function(t,e){try{t=(n=st.lookupPath(t,{follow:!e})).path}catch(o){}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=st.lookupPath(t,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=nt.basename(t),n=st.lookupPath(t,{follow:!e}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot="/"===n.path}catch(o){r.error=o.errno}return r},createPath:function(t,e,r,n){t="string"==typeof t?t:st.getPath(t);for(var o=e.split("/").reverse();o.length;){var i=o.pop();if(i){var a=nt.join2(t,i);try{st.mkdir(a)}catch(s){}t=a}}return a},createFile:function(t,e,r,n,o){var i=nt.join2("string"==typeof t?t:st.getPath(t),e),a=st.getMode(n,o);return st.create(i,a)},createDataFile:function(t,e,r,n,o,i){var a=e?nt.join2("string"==typeof t?t:st.getPath(t),e):t,s=st.getMode(n,o),u=st.create(a,s);if(r){if("string"==typeof r){for(var c=new Array(r.length),l=0,p=r.length;l<p;++l)c[l]=r.charCodeAt(l);r=c}st.chmod(u,146|s);var d=st.open(u,577);st.write(d,r,0,r.length,0,i),st.close(d),st.chmod(u,s)}return u},createDevice:function(t,e,r,n){var o=nt.join2("string"==typeof t?t:st.getPath(t),e),i=st.getMode(!!r,!!n);st.createDevice.major||(st.createDevice.major=64);var a=st.makedev(st.createDevice.major++,0);return st.registerDevice(a,{open:function(t){t.seekable=!1},close:function(t){n&&n.buffer&&n.buffer.length&&n(10)},read:function(t,e,n,o,i){for(var a=0,s=0;s<o;s++){var u;try{u=r()}catch(c){throw new st.ErrnoError(29)}if(void 0===u&&0===a)throw new st.ErrnoError(6);if(null==u)break;a++,e[n+s]=u}return a&&(t.node.timestamp=Date.now()),a},write:function(t,e,r,o,i){for(var a=0;a<o;a++)try{n(e[r+a])}catch(s){throw new st.ErrnoError(29)}return o&&(t.node.timestamp=Date.now()),a}}),st.mkdev(o,i,a)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!d)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=mt(d(t.url),!0),t.usedBytes=t.contents.length}catch(e){throw new st.ErrnoError(29)}},createLazyFile:function(t,e,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function(t){if(!(t>this.length-1||t<0)){var e=t%this.chunkSize;return this.getter(t/this.chunkSize|0)[e]}},i.prototype.setDataGetter=function(t){this.getter=t},i.prototype.cacheLength=function(){var t=new XMLHttpRequest;if(t.open("HEAD",r,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw new Error("Couldn't load "+r+". Status: "+t.status);var e,n=Number(t.getResponseHeader("Content-length")),o=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,i=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,a=1048576;o||(a=n);var s=this;s.setDataGetter(function(t){var e=t*a,o=(t+1)*a-1;if(o=Math.min(o,n-1),void 0===s.chunks[t]&&(s.chunks[t]=function(t,e){if(t>e)throw new Error("invalid range ("+t+", "+e+") or no bytes requested!");if(e>n-1)throw new Error("only "+n+" bytes available! programmer error!");var o=new XMLHttpRequest;if(o.open("GET",r,!1),n!==a&&o.setRequestHeader("Range","bytes="+t+"-"+e),"undefined"!=typeof Uint8Array&&(o.responseType="arraybuffer"),o.overrideMimeType&&o.overrideMimeType("text/plain; charset=x-user-defined"),o.send(null),!(o.status>=200&&o.status<300||304===o.status))throw new Error("Couldn't load "+r+". Status: "+o.status);return void 0!==o.response?new Uint8Array(o.response||[]):mt(o.responseText||"",!0)}(e,o)),void 0===s.chunks[t])throw new Error("doXHR failed!");return s.chunks[t]}),!i&&n||(a=n=1,n=this.getter(0).length,a=n,g("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!u)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new i;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:a}}else s={isDevice:!1,url:r};var c=st.createFile(t,e,s,n,o);s.contents?c.contents=s.contents:s.url&&(c.contents=null,c.url=s.url),Object.defineProperties(c,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(c.stream_ops).forEach(function(t){var e=c.stream_ops[t];l[t]=function(){return st.forceLoadFile(c),e.apply(null,arguments)}}),l.read=function(t,e,r,n,o){st.forceLoadFile(c);var i=t.node.contents;if(o>=i.length)return 0;var a=Math.min(i.length-o,n);if(i.slice)for(var s=0;s<a;s++)e[r+s]=i[o+s];else for(s=0;s<a;s++)e[r+s]=i.get(o+s);return a},c.stream_ops=l,c},createPreloadedFile:function(t,e,r,n,i,a,s,u,c,l){Browser.init();var p=e?ot.resolve(nt.join2(t,e)):t;function d(r){function d(r){l&&l(),u||st.createDataFile(t,e,r,n,i,c),a&&a(),q()}var f=!1;o.preloadPlugins.forEach(function(t){f||t.canHandle(p)&&(t.handle(r,p,d,function(){s&&s(),q()}),f=!0)}),f||d(r)}H(),"string"==typeof r?Browser.asyncLoad(r,function(t){d(t)},s):d(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=st.indexedDB();try{var o=n.open(st.DB_NAME(),st.DB_VERSION)}catch(i){return r(i)}o.onupgradeneeded=function(){g("creating db"),o.result.createObjectStore(st.DB_STORE_NAME)},o.onsuccess=function(){var n=o.result.transaction([st.DB_STORE_NAME],"readwrite"),i=n.objectStore(st.DB_STORE_NAME),a=0,s=0,u=t.length;function c(){0==s?e():r()}t.forEach(function(t){var e=i.put(st.analyzePath(t).object.contents,t);e.onsuccess=function(){++a+s==u&&c()},e.onerror=function(){s++,a+s==u&&c()}}),n.onerror=r},o.onerror=r},loadFilesFromDB:function(t,e,r){e=e||function(){},r=r||function(){};var n=st.indexedDB();try{var o=n.open(st.DB_NAME(),st.DB_VERSION)}catch(i){return r(i)}o.onupgradeneeded=r,o.onsuccess=function(){var n=o.result;try{var a=n.transaction([st.DB_STORE_NAME],"readonly")}catch(i){return void r(i)}var s=a.objectStore(st.DB_STORE_NAME),u=0,c=0,l=t.length;function p(){0==c?e():r()}t.forEach(function(t){var e=s.get(t);e.onsuccess=function(){st.analyzePath(t).exists&&st.unlink(t),st.createDataFile(nt.dirname(t),nt.basename(t),e.result,!0,!0,!0),++u+c==l&&p()},e.onerror=function(){c++,u+c==l&&p()}}),a.onerror=r},o.onerror=r}},ut={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(t,e){if("/"!==e[0]){var r;if(-100===t)r=st.cwd();else{var n=st.getStream(t);if(!n)throw new st.ErrnoError(8);r=n.path}e=nt.join2(r,e)}return e},doStat:function(t,e,r){try{var n=t(e)}catch(o){if(o&&o.node&&nt.normalize(e)!==nt.normalize(st.getPath(o.node)))return-54;throw o}return D[r>>2]=n.dev,D[r+4>>2]=0,D[r+8>>2]=n.ino,D[r+12>>2]=n.mode,D[r+16>>2]=n.nlink,D[r+20>>2]=n.uid,D[r+24>>2]=n.gid,D[r+28>>2]=n.rdev,D[r+32>>2]=0,X=[n.size>>>0,(Q=n.size,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],D[r+40>>2]=X[0],D[r+44>>2]=X[1],D[r+48>>2]=4096,D[r+52>>2]=n.blocks,D[r+56>>2]=n.atime.getTime()/1e3|0,D[r+60>>2]=0,D[r+64>>2]=n.mtime.getTime()/1e3|0,D[r+68>>2]=0,D[r+72>>2]=n.ctime.getTime()/1e3|0,D[r+76>>2]=0,X=[n.ino>>>0,(Q=n.ino,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],D[r+80>>2]=X[0],D[r+84>>2]=X[1],0},doMsync:function(t,e,r,n,o){var i=k.slice(t,t+r);st.msync(e,i,o,r,n)},doMkdir:function(t,e){return"/"===(t=nt.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),st.mkdir(t,e,0),0},doMknod:function(t,e,r){switch(61440&e){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return st.mknod(t,e,r),0},doReadlink:function(t,e,r){if(r<=0)return-28;var n=st.readlink(t),o=Math.min(r,R(n)),i=S[e+o];return C(n,e,r+1),S[e+o]=i,o},doAccess:function(t,e){if(-8&e)return-28;var r;if(!(r=st.lookupPath(t,{follow:!0}).node))return-44;var n="";return 4&e&&(n+="r"),2&e&&(n+="w"),1&e&&(n+="x"),n&&st.nodePermissions(r,n)?-2:0},doDup:function(t,e,r){var n=st.getStream(r);return n&&st.close(n),st.open(t,e,0,r,r).fd},doReadv:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=D[e+(8*i+4)>>2],s=st.read(t,S,D[e+8*i>>2],a,n);if(s<0)return-1;if(o+=s,s<a)break}return o},doWritev:function(t,e,r,n){for(var o=0,i=0;i<r;i++){var a=st.write(t,S,D[e+8*i>>2],D[e+(8*i+4)>>2],n);if(a<0)return-1;o+=a}return o},varargs:void 0,get:function(){return ut.varargs+=4,D[ut.varargs-4>>2]},getStr:function(t){return M(t)},getStreamFromFD:function(t){var e=st.getStream(t);if(!e)throw new st.ErrnoError(8);return e},get64:function(t,e){return t}};function ct(t){return t%4==0&&(t%100!=0||t%400==0)}function lt(t,e){for(var r=0,n=0;n<=e;r+=t[n++]);return r}var pt=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function ft(t,e){for(var r=new Date(t.getTime());e>0;){var n=ct(r.getFullYear()),o=r.getMonth(),i=(n?pt:dt)[o];if(!(e>i-r.getDate()))return r.setDate(r.getDate()+e),r;e-=i-r.getDate()+1,r.setDate(1),o<11?r.setMonth(o+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1))}return r}var ht=function(t,e,r,n){t||(t=this),this.parent=t,this.mount=t.mount,this.mounted=null,this.id=st.nextInode++,this.name=e,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n};function mt(t,e,r){var n=r>0?r:R(t)+1,o=new Array(n),i=I(t,o,0,o.length);return e&&(o.length=i),o}Object.defineProperties(ht.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(t){t?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(t){t?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return st.isDir(this.mode)}},isDevice:{get:function(){return st.isChrdev(this.mode)}}}),st.FSNode=ht,st.staticInit(),j.push({func:function(){gt()}});var _t,yt={a:function(){V()},h:function(t,e){var r;if(0===t)r=Date.now();else{if(1!==t&&4!==t)return D[de()>>2]=28,-1;r=Z()}return D[e>>2]=r/1e3|0,D[e+4>>2]=r%1e3*1e3*1e3|0,0},l:function(t,e,r){k.copyWithin(t,e,e+r)},m:function(t){var e=k.length;if((t>>>=0)>2147483648)return!1;for(var r,n=1;n<=4;n*=2){var o=e*(1+.2/n);if(o=Math.min(o,t+100663296),tt(Math.min(2147483648,((r=Math.max(16777216,t,o))%65536>0&&(r+=65536-r%65536),r))))return!0}return!1},e:function(t,e){try{var r=0;return rt().forEach(function(n,o){var i=e+r;D[t+4*o>>2]=i,function(t,e,r){for(var n=0;n<t.length;++n)S[e++>>0]=t.charCodeAt(n);S[e>>0]=0}(n,i),r+=n.length+1}),0}catch(n){return void 0!==st&&n instanceof st.ErrnoError||V(n),n.errno}},f:function(t,e){try{var r=rt();D[t>>2]=r.length;var n=0;return r.forEach(function(t){n+=t.length+1}),D[e>>2]=n,0}catch(o){return void 0!==st&&o instanceof st.ErrnoError||V(o),o.errno}},j:function(t){be(t)},i:function(t){try{var e=ut.getStreamFromFD(t);return st.close(e),0}catch(r){return void 0!==st&&r instanceof st.ErrnoError||V(r),r.errno}},g:function(t,e,r,n){try{var o=ut.getStreamFromFD(t),i=ut.doReadv(o,e,r);return D[n>>2]=i,0}catch(a){return void 0!==st&&a instanceof st.ErrnoError||V(a),a.errno}},k:function(t,e,r,n,o){try{var i=ut.getStreamFromFD(t),a=4294967296*r+(e>>>0);return a<=-9007199254740992||a>=9007199254740992?-61:(st.llseek(i,a,n),X=[i.position>>>0,(Q=i.position,+Math.abs(Q)>=1?Q>0?(0|Math.min(+Math.floor(Q/4294967296),4294967295))>>>0:~~+Math.ceil((Q-+(~~Q>>>0))/4294967296)>>>0:0)],D[o>>2]=X[0],D[o+4>>2]=X[1],i.getdents&&0===a&&0===n&&(i.getdents=null),0)}catch(s){return void 0!==st&&s instanceof st.ErrnoError||V(s),s.errno}},b:function(t,e,r,n){try{var o=ut.getStreamFromFD(t),i=ut.doWritev(o,e,r);return D[n>>2]=i,0}catch(a){return void 0!==st&&a instanceof st.ErrnoError||V(a),a.errno}},c:function(t,e){!function t(){if(!t.called){t.called=!0;var e=(new Date).getFullYear(),r=new Date(e,0,1),n=new Date(e,6,1),o=r.getTimezoneOffset(),i=n.getTimezoneOffset(),a=Math.max(o,i);D[me()>>2]=60*a,D[he()>>2]=Number(o!=i);var s=p(r),u=p(n),c=A(s),l=A(u);i<o?(D[fe()>>2]=c,D[fe()+4>>2]=l):(D[fe()>>2]=l,D[fe()+4>>2]=c)}function p(t){var e=t.toTimeString().match(/\(([A-Za-z ]+)\)$/);return e?e[1]:"GMT"}}();var r=new Date(1e3*D[t>>2]);D[e>>2]=r.getSeconds(),D[e+4>>2]=r.getMinutes(),D[e+8>>2]=r.getHours(),D[e+12>>2]=r.getDate(),D[e+16>>2]=r.getMonth(),D[e+20>>2]=r.getFullYear()-1900,D[e+24>>2]=r.getDay();var n=new Date(r.getFullYear(),0,1),o=(r.getTime()-n.getTime())/864e5|0;D[e+28>>2]=o,D[e+36>>2]=-60*r.getTimezoneOffset();var i=new Date(r.getFullYear(),6,1).getTimezoneOffset(),a=n.getTimezoneOffset(),s=0|(i!=a&&r.getTimezoneOffset()==Math.min(a,i));D[e+32>>2]=s;var u=D[fe()+(s?4:0)>>2];return D[e+40>>2]=u,e},d:function(t,e,r,n){return function(t,e,r,n){var o=D[n+40>>2],i={tm_sec:D[n>>2],tm_min:D[n+4>>2],tm_hour:D[n+8>>2],tm_mday:D[n+12>>2],tm_mon:D[n+16>>2],tm_year:D[n+20>>2],tm_wday:D[n+24>>2],tm_yday:D[n+28>>2],tm_isdst:D[n+32>>2],tm_gmtoff:D[n+36>>2],tm_zone:o?M(o):""},a=M(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in s)a=a.replace(new RegExp(u,"g"),s[u]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function p(t,e,r){for(var n="number"==typeof t?t.toString():t||"";n.length<e;)n=r[0]+n;return n}function d(t,e){return p(t,e,"0")}function f(t,e){function r(t){return t<0?-1:t>0?1:0}var n;return 0===(n=r(t.getFullYear()-e.getFullYear()))&&0===(n=r(t.getMonth()-e.getMonth()))&&(n=r(t.getDate()-e.getDate())),n}function h(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function m(t){var e=ft(new Date(t.tm_year+1900,0,1),t.tm_yday),r=new Date(e.getFullYear(),0,4),n=new Date(e.getFullYear()+1,0,4),o=h(r),i=h(n);return f(o,e)<=0?f(i,e)<=0?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var _={"%a":function(t){return c[t.tm_wday].substring(0,3)},"%A":function(t){return c[t.tm_wday]},"%b":function(t){return l[t.tm_mon].substring(0,3)},"%B":function(t){return l[t.tm_mon]},"%C":function(t){return d((t.tm_year+1900)/100|0,2)},"%d":function(t){return d(t.tm_mday,2)},"%e":function(t){return p(t.tm_mday,2," ")},"%g":function(t){return m(t).toString().substring(2)},"%G":function(t){return m(t)},"%H":function(t){return d(t.tm_hour,2)},"%I":function(t){var e=t.tm_hour;return 0==e?e=12:e>12&&(e-=12),d(e,2)},"%j":function(t){return d(t.tm_mday+lt(ct(t.tm_year+1900)?pt:dt,t.tm_mon-1),3)},"%m":function(t){return d(t.tm_mon+1,2)},"%M":function(t){return d(t.tm_min,2)},"%n":function(){return"\n"},"%p":function(t){return t.tm_hour>=0&&t.tm_hour<12?"AM":"PM"},"%S":function(t){return d(t.tm_sec,2)},"%t":function(){return"\t"},"%u":function(t){return t.tm_wday||7},"%U":function(t){var e=new Date(t.tm_year+1900,0,1),r=0===e.getDay()?e:ft(e,7-e.getDay()),n=new Date(t.tm_year+1900,t.tm_mon,t.tm_mday);if(f(r,n)<0){var o=lt(ct(n.getFullYear())?pt:dt,n.getMonth()-1)-31,i=31-r.getDate()+o+n.getDate();return d(Math.ceil(i/7),2)}return 0===f(r,e)?"01":"00"},"%V":function(t){var e,r=new Date(t.tm_year+1900,0,4),n=new Date(t.tm_year+1901,0,4),o=h(r),i=h(n),a=ft(new Date(t.tm_year+1900,0,1),t.tm_yday);return f(a,o)<0?"53":f(i,a)<=0?"01":(e=o.getFullYear()<t.tm_year+1900?t.tm_yday+32-o.getDate():t.tm_yday+1-o.getDate(),d(Math.ceil(e/7),2))},"%w":function(t){return t.tm_wday},"%W":function(t){var e=new Date(t.tm_year,0,1),r=1===e.getDay()?e:ft(e,0===e.getDay()?1:7-e.getDay()+1),n=new Date(t.tm_year+1900,t.tm_mon,t.tm_mday);if(f(r,n)<0){var o=lt(ct(n.getFullYear())?pt:dt,n.getMonth()-1)-31,i=31-r.getDate()+o+n.getDate();return d(Math.ceil(i/7),2)}return 0===f(r,e)?"01":"00"},"%y":function(t){return(t.tm_year+1900).toString().substring(2)},"%Y":function(t){return t.tm_year+1900},"%z":function(t){var e=t.tm_gmtoff,r=e>=0;return e=(e=Math.abs(e)/60)/60*100+e%60,(r?"+":"-")+String("0000"+e).slice(-4)},"%Z":function(t){return t.tm_zone},"%%":function(){return"%"}};for(var u in _)a.indexOf(u)>=0&&(a=a.replace(new RegExp(u,"g"),_[u](i)));var y=mt(a,!1);return y.length>e?0:(x(y,t),y.length-1)}(t,e,r,n)}},gt=(function(){var t={a:yt};function e(t,e){o.asm=t.exports,O((y=o.asm.n).buffer),z=o.asm.o,q()}function n(t){e(t.instance)}function i(e){return(m||!s&&!u||"function"!=typeof fetch?Promise.resolve().then(function(){return $(J)}):fetch(J,{credentials:"same-origin"}).then(function(t){if(!t.ok)throw"failed to load wasm binary file at '"+J+"'";return t.arrayBuffer()}).catch(function(){return $(J)})).then(function(e){return WebAssembly.instantiate(e,t)}).then(e,function(t){v("failed to asynchronously prepare wasm: "+t),V(t)})}if(H(),o.instantiateWasm)try{return o.instantiateWasm(t,e)}catch(a){return v("Module.instantiateWasm callback failed with error: "+a),!1}(m||"function"!=typeof WebAssembly.instantiateStreaming||W(J)||"function"!=typeof fetch?i(n):fetch(J,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(n,function(t){return v("wasm streaming compile failed: "+t),v("falling back to ArrayBuffer instantiation"),i(n)})})).catch(r)}(),o.___wasm_call_ctors=function(){return(gt=o.___wasm_call_ctors=o.asm.p).apply(null,arguments)}),vt=(o._free=function(){return(o._free=o.asm.q).apply(null,arguments)},o._malloc=function(){return(vt=o._malloc=o.asm.r).apply(null,arguments)}),wt=(o.___original_main=function(){return(o.___original_main=o.asm.s).apply(null,arguments)},o._main=function(){return(o._main=o.asm.t).apply(null,arguments)},o.___em_js__array_bounds_check_error=function(){return(o.___em_js__array_bounds_check_error=o.asm.u).apply(null,arguments)},o._emscripten_bind_VoidPtr___destroy___0=function(){return(wt=o._emscripten_bind_VoidPtr___destroy___0=o.asm.v).apply(null,arguments)}),bt=o._emscripten_bind_Cloudpilot_Cloudpilot_0=function(){return(bt=o._emscripten_bind_Cloudpilot_Cloudpilot_0=o.asm.w).apply(null,arguments)},Et=o._emscripten_bind_Cloudpilot_Malloc_1=function(){return(Et=o._emscripten_bind_Cloudpilot_Malloc_1=o.asm.x).apply(null,arguments)},St=o._emscripten_bind_Cloudpilot_Free_1=function(){return(St=o._emscripten_bind_Cloudpilot_Free_1=o.asm.y).apply(null,arguments)},kt=o._emscripten_bind_Cloudpilot_InitializeSession_3=function(){return(kt=o._emscripten_bind_Cloudpilot_InitializeSession_3=o.asm.z).apply(null,arguments)},Dt=o._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=function(){return(Dt=o._emscripten_bind_Cloudpilot_GetCyclesPerSecond_0=o.asm.A).apply(null,arguments)},Pt=o._emscripten_bind_Cloudpilot_RunEmulation_1=function(){return(Pt=o._emscripten_bind_Cloudpilot_RunEmulation_1=o.asm.B).apply(null,arguments)},Ft=o._emscripten_bind_Cloudpilot_CopyFrame_0=function(){return(Ft=o._emscripten_bind_Cloudpilot_CopyFrame_0=o.asm.C).apply(null,arguments)},Mt=o._emscripten_bind_Cloudpilot_IsScreenDirty_0=function(){return(Mt=o._emscripten_bind_Cloudpilot_IsScreenDirty_0=o.asm.D).apply(null,arguments)},It=o._emscripten_bind_Cloudpilot_MarkScreenClean_0=function(){return(It=o._emscripten_bind_Cloudpilot_MarkScreenClean_0=o.asm.E).apply(null,arguments)},Ct=o._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=function(){return(Ct=o._emscripten_bind_Cloudpilot_MinMemoryForDevice_1=o.asm.F).apply(null,arguments)},Rt=o._emscripten_bind_Cloudpilot_QueuePenMove_2=function(){return(Rt=o._emscripten_bind_Cloudpilot_QueuePenMove_2=o.asm.G).apply(null,arguments)},At=o._emscripten_bind_Cloudpilot_QueuePenUp_0=function(){return(At=o._emscripten_bind_Cloudpilot_QueuePenUp_0=o.asm.H).apply(null,arguments)},xt=o._emscripten_bind_Cloudpilot_QueueButtonDown_1=function(){return(xt=o._emscripten_bind_Cloudpilot_QueueButtonDown_1=o.asm.I).apply(null,arguments)},Ot=o._emscripten_bind_Cloudpilot_QueueButtonUp_1=function(){return(Ot=o._emscripten_bind_Cloudpilot_QueueButtonUp_1=o.asm.J).apply(null,arguments)},zt=o._emscripten_bind_Cloudpilot_IsPowerOff_0=function(){return(zt=o._emscripten_bind_Cloudpilot_IsPowerOff_0=o.asm.K).apply(null,arguments)},Bt=o._emscripten_bind_Cloudpilot_IsUIInitialized_0=function(){return(Bt=o._emscripten_bind_Cloudpilot_IsUIInitialized_0=o.asm.L).apply(null,arguments)},jt=o._emscripten_bind_Cloudpilot_Reset_0=function(){return(jt=o._emscripten_bind_Cloudpilot_Reset_0=o.asm.M).apply(null,arguments)},Gt=o._emscripten_bind_Cloudpilot_ResetNoExtensions_0=function(){return(Gt=o._emscripten_bind_Cloudpilot_ResetNoExtensions_0=o.asm.N).apply(null,arguments)},Lt=o._emscripten_bind_Cloudpilot_ResetHard_0=function(){return(Lt=o._emscripten_bind_Cloudpilot_ResetHard_0=o.asm.O).apply(null,arguments)},Tt=o._emscripten_bind_Cloudpilot_InstallFile_2=function(){return(Tt=o._emscripten_bind_Cloudpilot_InstallFile_2=o.asm.P).apply(null,arguments)},Nt=o._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=function(){return(Nt=o._emscripten_bind_Cloudpilot_GetPalette2bitMapping_0=o.asm.Q).apply(null,arguments)},Ut=o._emscripten_bind_Cloudpilot_GetMemoryPtr_0=function(){return(Ut=o._emscripten_bind_Cloudpilot_GetMemoryPtr_0=o.asm.R).apply(null,arguments)},Ht=o._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=function(){return(Ht=o._emscripten_bind_Cloudpilot_GetDirtyPagesPtr_0=o.asm.S).apply(null,arguments)},qt=o._emscripten_bind_Cloudpilot_GetMemorySize_0=function(){return(qt=o._emscripten_bind_Cloudpilot_GetMemorySize_0=o.asm.T).apply(null,arguments)},Vt=o._emscripten_bind_Cloudpilot_GetSavestatePtr_0=function(){return(Vt=o._emscripten_bind_Cloudpilot_GetSavestatePtr_0=o.asm.U).apply(null,arguments)},Wt=o._emscripten_bind_Cloudpilot_GetSavestateSize_0=function(){return(Wt=o._emscripten_bind_Cloudpilot_GetSavestateSize_0=o.asm.V).apply(null,arguments)},Yt=o._emscripten_bind_Cloudpilot_SaveState_0=function(){return(Yt=o._emscripten_bind_Cloudpilot_SaveState_0=o.asm.W).apply(null,arguments)},Qt=o._emscripten_bind_Cloudpilot_LoadState_2=function(){return(Qt=o._emscripten_bind_Cloudpilot_LoadState_2=o.asm.X).apply(null,arguments)},Xt=o._emscripten_bind_Cloudpilot___destroy___0=function(){return(Xt=o._emscripten_bind_Cloudpilot___destroy___0=o.asm.Y).apply(null,arguments)},Zt=o._emscripten_bind_RomInfo_RomInfo_2=function(){return(Zt=o._emscripten_bind_RomInfo_RomInfo_2=o.asm.Z).apply(null,arguments)},Jt=o._emscripten_bind_RomInfo_IsValid_0=function(){return(Jt=o._emscripten_bind_RomInfo_IsValid_0=o.asm._).apply(null,arguments)},$t=o._emscripten_bind_RomInfo_CardVersion_0=function(){return($t=o._emscripten_bind_RomInfo_CardVersion_0=o.asm.$).apply(null,arguments)},Kt=o._emscripten_bind_RomInfo_CardName_0=function(){return(Kt=o._emscripten_bind_RomInfo_CardName_0=o.asm.aa).apply(null,arguments)},te=o._emscripten_bind_RomInfo_RomVersion_0=function(){return(te=o._emscripten_bind_RomInfo_RomVersion_0=o.asm.ba).apply(null,arguments)},ee=o._emscripten_bind_RomInfo_RomVersionString_0=function(){return(ee=o._emscripten_bind_RomInfo_RomVersionString_0=o.asm.ca).apply(null,arguments)},re=o._emscripten_bind_RomInfo_Supports_1=function(){return(re=o._emscripten_bind_RomInfo_Supports_1=o.asm.da).apply(null,arguments)},ne=o._emscripten_bind_RomInfo___destroy___0=function(){return(ne=o._emscripten_bind_RomInfo___destroy___0=o.asm.ea).apply(null,arguments)},oe=o._emscripten_bind_Frame_GetLineWidth_0=function(){return(oe=o._emscripten_bind_Frame_GetLineWidth_0=o.asm.fa).apply(null,arguments)},ie=o._emscripten_bind_Frame_GetBpp_0=function(){return(ie=o._emscripten_bind_Frame_GetBpp_0=o.asm.ga).apply(null,arguments)},ae=o._emscripten_bind_Frame_GetLines_0=function(){return(ae=o._emscripten_bind_Frame_GetLines_0=o.asm.ha).apply(null,arguments)},se=o._emscripten_bind_Frame_GetMargin_0=function(){return(se=o._emscripten_bind_Frame_GetMargin_0=o.asm.ia).apply(null,arguments)},ue=o._emscripten_bind_Frame_GetBytesPerLine_0=function(){return(ue=o._emscripten_bind_Frame_GetBytesPerLine_0=o.asm.ja).apply(null,arguments)},ce=o._emscripten_bind_Frame_GetBuffer_0=function(){return(ce=o._emscripten_bind_Frame_GetBuffer_0=o.asm.ka).apply(null,arguments)},le=o._emscripten_bind_Frame_GetBufferSize_0=function(){return(le=o._emscripten_bind_Frame_GetBufferSize_0=o.asm.la).apply(null,arguments)},pe=o._emscripten_bind_Frame___destroy___0=function(){return(pe=o._emscripten_bind_Frame___destroy___0=o.asm.ma).apply(null,arguments)},de=o.___errno_location=function(){return(de=o.___errno_location=o.asm.na).apply(null,arguments)},fe=o.__get_tzname=function(){return(fe=o.__get_tzname=o.asm.oa).apply(null,arguments)},he=o.__get_daylight=function(){return(he=o.__get_daylight=o.asm.pa).apply(null,arguments)},me=o.__get_timezone=function(){return(me=o.__get_timezone=o.asm.qa).apply(null,arguments)},_e=o.stackSave=function(){return(_e=o.stackSave=o.asm.ra).apply(null,arguments)},ye=o.stackRestore=function(){return(ye=o.stackRestore=o.asm.sa).apply(null,arguments)},ge=o.stackAlloc=function(){return(ge=o.stackAlloc=o.asm.ta).apply(null,arguments)};function ve(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function we(t){function r(){_t||(_t=!0,o.calledRun=!0,w||(o.noFSInit||st.init.initialized||st.init(),it.init(),K(j),st.ignorePermissions=!1,K(G),e(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),Ee&&function(t){var e=o._main;try{be(e(0,0),!0)}catch(n){if(n instanceof ve)return;if("unwind"==n)return void(_=!0);var r=n;n&&"object"==typeof n&&n.stack&&(r=[n,n.stack]),v("exception thrown: "+r),p(1,n)}}(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)t=o.postRun.shift(),L.unshift(t);var t;K(L)}()))}t=t||c,T>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)t=o.preRun.shift(),B.unshift(t);var t;K(B)}(),T>0||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),r()},1)):r()))}function be(t,e){e&&_&&0===t||(_||(o.onExit&&o.onExit(t),w=!0),p(t,new ve(t)))}if(o.ccall=function(t,e,r,n,i){var a={string:function(t){var e=0;if(null!=t&&0!==t){var r=1+(t.length<<2);C(t,e=ge(r),r)}return e},array:function(t){var e=ge(t.length);return x(t,e),e}},s=function(t){var e=o["_"+t];return b(e,"Cannot call unknown function "+t+", make sure it is exported"),e}(t),u=[],c=0;if(n)for(var l=0;l<n.length;l++){var p=a[r[l]];p?(0===c&&(c=_e()),u[l]=p(n[l])):u[l]=n[l]}var d=s.apply(null,u);return d=function(t){return"string"===e?M(t):"boolean"===e?Boolean(t):t}(d),0!==c&&ye(c),d},U=function t(){_t||we(),_t||(U=t)},o.run=we,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();var Ee=!0;function Se(){}function ke(t){return(t||Se).__cache__}function De(t,e){var r=ke(e),n=r[t];return n||((n=Object.create((e||Se).prototype)).ptr=t,r[t]=n)}o.noInitialRun&&(Ee=!1),_=!0,we(),(Se.prototype=Object.create(Se.prototype)).constructor=Se,Se.prototype.__class__=Se,Se.__cache__={},o.WrapperObject=Se,o.getCache=ke,o.wrapPointer=De,o.castObject=function(t,e){return De(t.ptr,e)},o.NULL=De(0),o.destroy=function(t){if(!t.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";t.__destroy__(),delete ke(t.__class__)[t.ptr]},o.compare=function(t,e){return t.ptr===e.ptr},o.getPointer=function(t){return t.ptr},o.getClass=function(t){return t.__class__};var Pe={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Pe.needed){for(var t=0;t<Pe.temps.length;t++)o._free(Pe.temps[t]);Pe.temps.length=0,o._free(Pe.buffer),Pe.buffer=0,Pe.size+=Pe.needed,Pe.needed=0}Pe.buffer||(Pe.size+=128,Pe.buffer=o._malloc(Pe.size),b(Pe.buffer)),Pe.pos=0},alloc:function(t,e){b(Pe.buffer);var r,n=t.length*e.BYTES_PER_ELEMENT;return Pe.pos+(n=n+7&-8)>=Pe.size?(b(n>0),Pe.needed+=n,r=o._malloc(n),Pe.temps.push(r)):(r=Pe.buffer+Pe.pos,Pe.pos+=n),r},copy:function(t,e,r){switch(r>>>=0,e.BYTES_PER_ELEMENT){case 2:r>>>=1;break;case 4:r>>>=2;break;case 8:r>>>=3}for(var n=0;n<t.length;n++)e[r+n]=t[n]}};function Fe(t){if("string"==typeof t){var e=mt(t),r=Pe.alloc(e,S);return Pe.copy(e,S,r),r}return t}function Me(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Ie(){this.ptr=bt(),ke(Ie)[this.ptr]=this}function Ce(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),this.ptr=Zt(t,e),ke(Ce)[this.ptr]=this}function Re(){throw"cannot construct a Frame, no constructor in IDL"}return(Me.prototype=Object.create(Se.prototype)).constructor=Me,Me.prototype.__class__=Me,Me.__cache__={},o.VoidPtr=Me,Me.prototype.__destroy__=Me.prototype.__destroy__=function(){wt(this.ptr)},(Ie.prototype=Object.create(Se.prototype)).constructor=Ie,Ie.prototype.__class__=Ie,Ie.__cache__={},o.Cloudpilot=Ie,Ie.prototype.Malloc=Ie.prototype.Malloc=function(t){return t&&"object"==typeof t&&(t=t.ptr),De(Et(this.ptr,t),Me)},Ie.prototype.Free=Ie.prototype.Free=function(t){t&&"object"==typeof t&&(t=t.ptr),St(this.ptr,t)},Ie.prototype.InitializeSession=Ie.prototype.InitializeSession=function(t,e,r){var n=this.ptr;return Pe.prepare(),t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),r=r&&"object"==typeof r?r.ptr:Fe(r),!!kt(n,t,e,r)},Ie.prototype.GetCyclesPerSecond=Ie.prototype.GetCyclesPerSecond=function(){return Dt(this.ptr)},Ie.prototype.RunEmulation=Ie.prototype.RunEmulation=function(t){return t&&"object"==typeof t&&(t=t.ptr),Pt(this.ptr,t)},Ie.prototype.CopyFrame=Ie.prototype.CopyFrame=function(){return De(Ft(this.ptr),Re)},Ie.prototype.IsScreenDirty=Ie.prototype.IsScreenDirty=function(){return!!Mt(this.ptr)},Ie.prototype.MarkScreenClean=Ie.prototype.MarkScreenClean=function(){It(this.ptr)},Ie.prototype.MinMemoryForDevice=Ie.prototype.MinMemoryForDevice=function(t){var e=this.ptr;return Pe.prepare(),t=t&&"object"==typeof t?t.ptr:Fe(t),Ct(e,t)},Ie.prototype.QueuePenMove=Ie.prototype.QueuePenMove=function(t,e){t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Rt(this.ptr,t,e)},Ie.prototype.QueuePenUp=Ie.prototype.QueuePenUp=function(){At(this.ptr)},Ie.prototype.QueueButtonDown=Ie.prototype.QueueButtonDown=function(t){t&&"object"==typeof t&&(t=t.ptr),xt(this.ptr,t)},Ie.prototype.QueueButtonUp=Ie.prototype.QueueButtonUp=function(t){t&&"object"==typeof t&&(t=t.ptr),Ot(this.ptr,t)},Ie.prototype.IsPowerOff=Ie.prototype.IsPowerOff=function(){return!!zt(this.ptr)},Ie.prototype.IsUIInitialized=Ie.prototype.IsUIInitialized=function(){return!!Bt(this.ptr)},Ie.prototype.Reset=Ie.prototype.Reset=function(){jt(this.ptr)},Ie.prototype.ResetNoExtensions=Ie.prototype.ResetNoExtensions=function(){Gt(this.ptr)},Ie.prototype.ResetHard=Ie.prototype.ResetHard=function(){Lt(this.ptr)},Ie.prototype.InstallFile=Ie.prototype.InstallFile=function(t,e){return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),Tt(this.ptr,t,e)},Ie.prototype.GetPalette2bitMapping=Ie.prototype.GetPalette2bitMapping=function(){return Nt(this.ptr)},Ie.prototype.GetMemoryPtr=Ie.prototype.GetMemoryPtr=function(){return De(Ut(this.ptr),Me)},Ie.prototype.GetDirtyPagesPtr=Ie.prototype.GetDirtyPagesPtr=function(){return De(Ht(this.ptr),Me)},Ie.prototype.GetMemorySize=Ie.prototype.GetMemorySize=function(){return qt(this.ptr)},Ie.prototype.GetSavestatePtr=Ie.prototype.GetSavestatePtr=function(){return De(Vt(this.ptr),Me)},Ie.prototype.GetSavestateSize=Ie.prototype.GetSavestateSize=function(){return Wt(this.ptr)},Ie.prototype.SaveState=Ie.prototype.SaveState=function(){return!!Yt(this.ptr)},Ie.prototype.LoadState=Ie.prototype.LoadState=function(t,e){return t&&"object"==typeof t&&(t=t.ptr),e&&"object"==typeof e&&(e=e.ptr),!!Qt(this.ptr,t,e)},Ie.prototype.__destroy__=Ie.prototype.__destroy__=function(){Xt(this.ptr)},(Ce.prototype=Object.create(Se.prototype)).constructor=Ce,Ce.prototype.__class__=Ce,Ce.__cache__={},o.RomInfo=Ce,Ce.prototype.IsValid=Ce.prototype.IsValid=function(){return!!Jt(this.ptr)},Ce.prototype.CardVersion=Ce.prototype.CardVersion=function(){return $t(this.ptr)},Ce.prototype.CardName=Ce.prototype.CardName=function(){return M(Kt(this.ptr))},Ce.prototype.RomVersion=Ce.prototype.RomVersion=function(){return te(this.ptr)},Ce.prototype.RomVersionString=Ce.prototype.RomVersionString=function(){return M(ee(this.ptr))},Ce.prototype.Supports=Ce.prototype.Supports=function(t){var e=this.ptr;return Pe.prepare(),t=t&&"object"==typeof t?t.ptr:Fe(t),!!re(e,t)},Ce.prototype.__destroy__=Ce.prototype.__destroy__=function(){ne(this.ptr)},(Re.prototype=Object.create(Se.prototype)).constructor=Re,Re.prototype.__class__=Re,Re.__cache__={},o.Frame=Re,Re.prototype.GetLineWidth=Re.prototype.GetLineWidth=function(){return oe(this.ptr)},Re.prototype.GetBpp=Re.prototype.GetBpp=function(){return ie(this.ptr)},Re.prototype.GetLines=Re.prototype.GetLines=function(){return ae(this.ptr)},Re.prototype.GetMargin=Re.prototype.GetMargin=function(){return se(this.ptr)},Re.prototype.GetBytesPerLine=Re.prototype.GetBytesPerLine=function(){return ue(this.ptr)},Re.prototype.GetBuffer=Re.prototype.GetBuffer=function(){return De(ce(this.ptr),Me)},Re.prototype.GetBufferSize=Re.prototype.GetBufferSize=function(){return le(this.ptr)},Re.prototype.__destroy__=Re.prototype.__destroy__=function(){pe(this.ptr)},t.ready}),a=r("z9fa");const s=[a.a.palmV,a.a.m515];class u{constructor(t){this.module=t,this.cloudpilot=new t.Cloudpilot}static create(){return Object(o.a)(this,void 0,void 0,function*(){return new u(yield i({print:t=>console.log(t),printErr:t=>console.error(t)}))})}getRomInfo(t){const e=this.copyIn(t),r=new this.module.RomInfo(e,t.length);let n;return r.IsValid()&&(n={cardVersion:r.CardVersion(),cardName:r.CardName(),romVersion:r.RomVersion(),romVersionString:r.RomVersionString(),supportedDevices:s.filter(r.Supports.bind(r))}),this.cloudpilot.Free(e),this.module.destroy(r),n}initializeSession(t,e){const r=this.copyIn(t),n=this.cloudpilot.InitializeSession(r,t.length,e);return this.cloudpilot.Free(r),n}destroy(){this.module.destroy(this.cloudpilot)}cyclesPerSecond(){return this.cloudpilot.GetCyclesPerSecond()}runEmulation(t){return this.cloudpilot.RunEmulation(t)}getFrame(){const t=this.cloudpilot.CopyFrame(),e=this.module.getPointer(t.GetBuffer());return{bpp:t.GetBpp(),bytesPerLine:t.GetBytesPerLine(),lines:t.GetLines(),lineWidth:t.GetLineWidth(),margin:t.GetMargin(),buffer:this.module.HEAPU8.subarray(e,e+t.GetBufferSize())}}isScreenDirty(){return this.cloudpilot.IsScreenDirty()}markScreenClean(){this.cloudpilot.MarkScreenClean()}minRamForDevice(t){return 1024*this.cloudpilot.MinMemoryForDevice(t)}queuePenMove(t,e){this.cloudpilot.QueuePenMove(t,e)}queuePenUp(){this.cloudpilot.QueuePenUp()}queueButtonDown(t){this.cloudpilot.QueueButtonDown(t)}queueButtonUp(t){this.cloudpilot.QueueButtonUp(t)}isPowerOff(){return!!this.cloudpilot.IsPowerOff()}isUiInitialized(){return!!this.cloudpilot.IsUIInitialized()}reset(){this.cloudpilot.Reset()}resetNoExtensions(){this.cloudpilot.ResetNoExtensions()}resetHard(){this.cloudpilot.ResetHard()}installFile(t){const e=this.copyIn(t),r=this.cloudpilot.InstallFile(e,t.length);return this.cloudpilot.Free(e),r}getPalette2bitMapping(){return this.cloudpilot.GetPalette2bitMapping()}getMemory(){const t=this.module.getPointer(this.cloudpilot.GetMemoryPtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetMemorySize())}getDirtyPages(){const t=this.module.getPointer(this.cloudpilot.GetDirtyPagesPtr()),e=this.cloudpilot.GetMemorySize();return this.module.HEAPU8.subarray(t,t+(e>>>13))}getSavestate(){const t=this.module.getPointer(this.cloudpilot.GetSavestatePtr());return this.module.HEAPU8.subarray(t,t+this.cloudpilot.GetSavestateSize())}saveState(){return!!this.cloudpilot.SaveState()}loadState(t){const e=this.copyIn(t),r=this.cloudpilot.LoadState(e,t.length);return this.cloudpilot.Free(e),r}copyIn(t){const e=this.cloudpilot.Malloc(t.length),r=this.module.getPointer(e);return this.module.HEAP8.subarray(r,r+t.length).set(t),e}}var c=r("xOb2"),l=r("2aYl"),p=r("W2/1"),d=r("8Y7J"),f=r("51w2"),h=r("Ld/c"),m=r("hq03");const _=new Error("transaction timeout"),y=new Error("session does not match emulation");let g=(()=>{class t{constructor(t,e,r,n,o){this.storageService=t,this.pageLockService=e,this.emulationState=r,this.alertService=n,this.ngZone=o,this.defunct=!1,this.sessionId=-1,this.consecutiveErrorCount=0,this.snapshotInProgress=!1,this.pendingSnapshotPromise=Promise.resolve(void 0)}initialize(t,e){return Object(o.a)(this,void 0,void 0,function*(){if(this.defunct||this.pageLockService.lockLost())return;const r=1024*t.ram;this.sessionId=t.id,this.dirtyPages=new Uint8Array(r>>3),this.pages=new Array(r),this.state=void 0;for(let t=0;t<r;t++)this.pages[t]=new Uint8Array(1024);this.db=yield this.storageService.getDb(),this.cloudpilot=e})}getHealth(){return this.defunct?2:this.consecutiveErrorCount>0?1:0}triggerSnapshot(){return this.sessionId<0?Promise.resolve():this.snapshotInProgress?this.pendingSnapshotPromise:this.defunct?Promise.reject():(this.snapshotInProgress=!0,this.pendingSnapshotPromise=(()=>Object(o.a)(this,void 0,void 0,function*(){try{yield this.triggerSnapshotUnguarded()}finally{this.snapshotInProgress=!1}}))(),this.pendingSnapshotPromise)}waitForPendingSnapshot(){return this.snapshotInProgress?this.pendingSnapshotPromise:this.defunct?Promise.reject():Promise.resolve()}triggerSnapshotUnguarded(){return Object(o.a)(this,void 0,void 0,function*(){for(;;)try{return yield this.triggerSnapshotOnce(),void(0!==this.consecutiveErrorCount&&this.ngZone.run(()=>this.consecutiveErrorCount=0))}catch(t){if(console.error("snapshot error",t),t===y)throw t;if(t===c.a)throw this.ngZone.run(()=>this.defunct=!0),t;if(++this.consecutiveErrorCount>3)throw this.ngZone.run(()=>this.defunct=!0),yield this.alertService.fatalError("IndexedDB access lost. This is most likely a browser bug."),t}})}triggerSnapshotOnce(){var t;return Object(o.a)(this,void 0,void 0,function*(){const e=this.db.transaction([l.d,l.g],"readwrite");if(yield this.storageService.acquireLock(e.objectStore(l.g),-1),(null===(t=this.emulationState.getCurrentSession())||void 0===t?void 0:t.id)!==this.sessionId)throw y;yield new Promise((t,r)=>{let n=!1;const o=setTimeout(()=>{n=!0,e.abort(),r(_)},1e3);e.oncomplete=()=>{clearTimeout(o),this.dirtyPages.fill(0),t()},e.onerror=()=>{var t;clearTimeout(o),r(new Error(null===(t=e.error)||void 0===t?void 0:t.message))};try{this.saveDirtyMemory(e),this.saveSession(e)}catch(i){throw n||(clearTimeout(o),e.abort()),i}})})}saveDirtyMemory(t){let e=0;const r=t.objectStore(l.d),n=this.cloudpilot.getDirtyPages(),o=this.cloudpilot.getMemory();for(let i=0;i<n.length;i++)if(this.dirtyPages[i]|=n[i],n[i]=0,0!==this.dirtyPages[i])for(let t=0;t<8;t++){if(this.dirtyPages[i]&1<<t){const t=Object(p.b)(o.subarray(1024*e,1024*(e+1)));"number"==typeof t?r.put(t,[this.sessionId,e]):(this.pages[e].set(t),r.put(this.pages[e],[this.sessionId,e]))}e++}else e+=8}saveSession(t){const e=t.objectStore(l.g);if(this.cloudpilot.saveState()){const t=this.cloudpilot.getSavestate();this.state||(this.state=new Uint8Array(t.length)),this.state.set(t),e.put(this.state,this.sessionId)}else console.log("save state failed"),e.delete(this.sessionId)}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(c.b),d.Qb(f.a),d.Qb(h.a),d.Qb(m.a),d.Qb(d.B))},t.\u0275prov=d.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var v=r("hlg+"),w=(new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked"),new Error("request for lock canceled")),b=function(){function t(t,e){if(void 0===e&&(e=w),this._maxConcurrency=t,this._cancelError=e,this._queue=[],t<=0)throw new Error("semaphore must be initialized to a positive value");this._value=t}return t.prototype.acquire=function(){var t=this,e=this.isLocked(),r=new Promise(function(e,r){return t._queue.push({resolve:e,reject:r})});return e||this._dispatch(),r},t.prototype.runExclusive=function(t){return Object(o.a)(this,void 0,void 0,function(){var e,r,n;return Object(o.b)(this,function(o){switch(o.label){case 0:return[4,this.acquire()];case 1:e=o.sent(),r=e[0],n=e[1],o.label=2;case 2:return o.trys.push([2,,4,5]),[4,t(r)];case 3:return[2,o.sent()];case 4:return n(),[7];case 5:return[2]}})})},t.prototype.isLocked=function(){return this._value<=0},t.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var t=this._currentReleaser;this._currentReleaser=void 0,t()}},t.prototype.cancel=function(){var t=this;this._queue.forEach(function(e){return e.reject(t._cancelError)}),this._queue=[]},t.prototype._dispatch=function(){var t=this,e=this._queue.shift();if(e){var r=!1;this._currentReleaser=function(){r||(r=!0,t._value++,t._dispatch())},e.resolve([this._value--,this._currentReleaser])}},t}(),E=function(){function t(t){this._semaphore=new b(1,t)}return t.prototype.acquire=function(){return Object(o.a)(this,void 0,void 0,function(){return Object(o.b)(this,function(t){switch(t.label){case 0:return[4,this._semaphore.acquire()];case 1:return[2,t.sent()[1]]}})})},t.prototype.runExclusive=function(t){return this._semaphore.runExclusive(function(){return t()})},t.prototype.isLocked=function(){return this._semaphore.isLocked()},t.prototype.release=function(){this._semaphore.release()},t.prototype.cancel=function(){return this._semaphore.cancel()},t}(),S=r("sZkV");const k=[4292006610,4291085508,4290164406,4289243304,4288322202,4287401100,4286479998,4285558896,4284637794,4283716692,4282795590,4281874488,4280953386,4280032284,4279111182,4278190080],D=k.map(t=>"#"+(16777215&t).toString(16).padStart(6,"0"));let P=(()=>{class t{constructor(t,e,r,n,i,a){this.storageService=t,this.ngZone=e,this.loadingController=r,this.emulationState=n,this.snapshotService=i,this.switchSession=t=>this.mutex.runExclusive(()=>Object(o.a)(this,void 0,void 0,function*(){var e;if(t===(null===(e=this.emulationState.getCurrentSession())||void 0===e?void 0:e.id))return;const r=yield this.loadingController.create({message:"Loading..."});yield r.present();try{const e=yield this.storageService.getSession(t);if(this.emulationState.setCurrentSession(e),!e)throw new Error(`invalid session ${t}`);const[n,o,i]=yield this.storageService.loadSession(e);if(!n)throw new Error(`invalid ROM ${e.rom}`);const a=yield this.cloudpilot;let s=!1;if(a.initializeSession(n,e.device),o){const t=a.getMemory();t.length===o.length?(t.set(o),s=!0):console.error(`memory size mismatch; ${t.length} vs. ${o.length} - ignoring image`)}s&&i&&a.loadState(i),this.clearCanvas(),yield this.snapshotService.initialize(e,yield this.cloudpilot)}finally{yield r.dismiss()}})),this.resume=()=>this.mutex.runExclusive(()=>Object(o.a)(this,void 0,void 0,function*(){console.log("resume"),this.emulationState.getCurrentSession()&&!this.running&&2!==this.snapshotService.getHealth()&&(this.cloudpilotInstance=yield this.cloudpilot,this.clockEmulator=performance.now(),this.ngZone.runOutsideAngular(()=>this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame)),this.lastSnapshotAt=performance.now(),this.running=!0)})),this.pause=()=>this.mutex.runExclusive(()=>Object(o.a)(this,void 0,void 0,function*(){console.log("pause"),yield this.stopLoop(),2!==this.snapshotService.getHealth()&&(yield this.snapshotService.waitForPendingSnapshot(),yield this.snapshotService.triggerSnapshot())})),this.onSessionChange=t=>this.mutex.runExclusive(()=>Object(o.a)(this,void 0,void 0,function*(){var e;t===(null===(e=this.emulationState.getCurrentSession())||void 0===e?void 0:e.id)&&(this.emulationState.setCurrentSession(yield this.storageService.getSession(t)),this.emulationState.getCurrentSession()||(yield this.stopLoop()))})),this.onAnimationFrame=t=>{t-this.clockEmulator>500&&(this.clockEmulator=t-10);const e=(t-this.clockEmulator)/1e3*this.cloudpilotInstance.cyclesPerSecond();let r=0;for(;r<e;)r+=this.cloudpilotInstance.runEmulation(Math.ceil(e-r));this.clockEmulator+=r/this.cloudpilotInstance.cyclesPerSecond()*1e3,this.cloudpilotInstance.isScreenDirty()&&(this.updateScreen(),this.cloudpilotInstance.markScreenClean());const n=this.cloudpilotInstance.isPowerOff(),o=this.cloudpilotInstance.isUiInitialized();n===this.powerOff&&o===this.uiInitialized||this.ngZone.run(()=>{this.powerOff=n,this.uiInitialized=o}),t-this.lastSnapshotAt>1e3&&(this.snapshotService.triggerSnapshot(),this.lastSnapshotAt=t),2!==this.snapshotService.getHealth()&&(this.animationFrameHandle=requestAnimationFrame(this.onAnimationFrame))},this.cloudpilot=u.create(),this.newFrame=new v.Event,this.clockEmulator=0,this.animationFrameHandle=-1,this.mutex=new E,this.canvas=document.createElement("canvas"),this.imageData=new ImageData(160,160),this.imageData32=new Uint32Array(this.imageData.data.buffer),this.lastPenUpdate=0,this.penDown=!1,this.running=!1,this.powerOff=!1,this.uiInitialized=!1,this.lastSnapshotAt=0,this.canvas.width=160,this.canvas.height=160,this.imageData.data.fill(255);const s=this.canvas.getContext("2d");if(!s)throw new Error("get a new browser");this.context=s,t.sessionChangeEvent.addHandler(this.onSessionChange),a.lockLostEvent.addHandler(this.pause)}handlePointerMove(t,e){const r=performance.now();this.penDown=!0,r-this.lastPenUpdate<25||!this.cloudpilotInstance||(this.cloudpilotInstance.queuePenMove(t,e),this.lastPenUpdate=r)}handlePointerUp(){this.cloudpilotInstance&&this.penDown&&this.cloudpilotInstance.queuePenUp(),this.lastPenUpdate=0,this.penDown=!1}handleButtonDown(t){this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonDown(t)}handleButtonUp(t){this.cloudpilotInstance&&this.cloudpilotInstance.queueButtonUp(t)}reset(){this.cloudpilotInstance&&this.cloudpilotInstance.reset()}resetNoExtensions(){this.cloudpilotInstance&&this.cloudpilotInstance.resetNoExtensions()}resetHard(){this.cloudpilotInstance&&this.cloudpilotInstance.resetHard()}isRunning(){return this.running}isPowerOff(){return this.powerOff}isUiInitialized(){return this.uiInitialized}installFile(t){return this.cloudpilot.then(e=>e.installFile(t))}getCanvas(){return this.canvas}stopLoop(){this.running&&(this.animationFrameHandle>0&&(cancelAnimationFrame(this.animationFrameHandle),this.animationFrameHandle=-1),this.running=!1)}clearCanvas(){var t;this.context.beginPath(),this.context.rect(0,0,160,160),this.context.fillStyle=(null===(t=this.emulationState.getCurrentSession())||void 0===t?void 0:t.device)===a.a.m515?"white":D[0],this.context.fill()}updateScreen(){const t=this.cloudpilotInstance.getFrame();if(this.cloudpilotInstance.isPowerOff())return this.clearCanvas(),void this.newFrame.dispatch(this.canvas);if(t.lines===this.imageData.height&&t.lineWidth===this.imageData.width)switch(t.bpp){case 1:{const e=k[15],r=k[0];for(let n=0;n<160;n++)for(let o=0;o<160;o++)this.imageData32[160*n+o+t.margin]=t.buffer[n*t.bytesPerLine+(o+t.margin>>>3)]&128>>>(o+t.margin&7)?e:r;break}case 2:{const e=this.cloudpilotInstance.getPalette2bitMapping(),r=[k[15&e],k[e>>>4&15],k[e>>>8&15],k[e>>>12&15]];for(let n=0;n<160;n++)for(let e=0;e<160;e++)this.imageData32[160*n+e+t.margin]=r[t.buffer[n*t.bytesPerLine+(e+t.margin>>>2)]>>6-2*(e+t.margin&3)&3];break}case 4:for(let e=0;e<160;e++)for(let r=0;r<160;r++)this.imageData32[160*e+r+t.margin]=k[t.buffer[e*t.bytesPerLine+(r+t.margin>>>1)]>>>4-4*(r+t.margin&1)&15];break;case 24:for(let e=0;e<160;e++)for(let r=0;r<160;r++){const n=4*(160*e+r+t.margin),o=3*(160*e+r+t.margin);this.imageData.data[n]=t.buffer[o],this.imageData.data[n+1]=t.buffer[o+1],this.imageData.data[n+2]=t.buffer[o+2]}}this.context.putImageData(this.imageData,0,0),this.newFrame.dispatch(this.canvas)}}return t.\u0275fac=function(e){return new(e||t)(d.Qb(c.b),d.Qb(d.B),d.Qb(S.v),d.Qb(h.a),d.Qb(g),d.Qb(f.a))},t.\u0275prov=d.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},shLW:function(t,e,r){"use strict";r.d(e,"a",function(){return a});var n=r("mrSG"),o=r("8Y7J");function i(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}let a=(()=>{class t{openFile(t){return this.openFilesImpl(!1,e=>{e.length>0&&t(e[0])})}openFiles(t){return this.openFilesImpl(!0,t)}parseSessionImage(t){if(t.length<16)return;if(538247427!==i(t,0))return;if(0==(-2147483648&i(t,4)))return this.parseSessionImageLegacy(t);if(-2147483647!==i(t,4))return;if(t.length<28)return;const e=i(t,8),r=i(t,12),n=i(t,16),o=i(t,20),a=i(t,24);if(28+e+r+n+o+a!==t.length)return;let s;try{s=JSON.parse((new TextDecoder).decode(t.subarray(28+e,28+e+r)))}catch(u){console.warn("metadata is not valid JSON")}return{metadata:s,deviceId:(new TextDecoder).decode(t.subarray(28,28+e)),rom:t.subarray(28+e+r,28+e+r+n),memory:t.subarray(28+e+r+n,28+e+r+n+o),savestate:a>0?t.subarray(28+e+r+n+o):void 0}}parseSessionImageLegacy(t){const e=i(t,4),r=i(t,8);if(e+r+i(t,12)+16===t.length)return{deviceId:"PalmV",rom:t.subarray(16+e,16+e+r),memory:t.subarray(16+e+r),savestate:new Uint8Array(0)}}openFilesImpl(t,e){const r=document.createElement("input");r.type="file",r.multiple=t,r.onchange=t=>Object(n.a)(this,void 0,void 0,function*(){var r,n;const o=t.target;if(!(null===(r=null==o?void 0:o.files)||void 0===r?void 0:r.length))return[];const i=[];for(let t=0;t<(null===(n=o.files)||void 0===n?void 0:n.length);t++){const e=o.files.item(t);if(!e)continue;const r=new Promise((t,r)=>{const n=new FileReader;n.onload=()=>t({content:new Uint8Array(n.result),name:e.name}),n.onerror=()=>r(n.error),n.readAsArrayBuffer(e)});i.push(r)}e(yield Promise.all(i))}),r.click()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},z9fa:function(t,e,r){"use strict";r.d(e,"a",function(){return n});var n=function(t){return t.palmV="PalmV",t.m515="PalmM515",t}({})}}]);