!function(){function e(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function t(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(c){r=!0,o=c}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{"6aA7":function(i,r,a){"use strict";a.r(r),a.d(r,"EmulationPageModule",function(){return L});var c,u,l,h,d=a("SVse"),v=a("iInd"),f=a("mrSG"),b=3*devicePixelRatio,m=new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=function(){return t()},n.src="assets/silkscreen.svg"}),p=function(){function e(t){o(this,e),this.canvas=t;var n=t.getContext("2d");if(!n)throw new Error("get a new browser");this.ctx=n}return s(e,[{key:"clear",value:function(){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.fillRect(0,0,160,250,"#d2d2d2"),e.next=3,this.drawSilkscreen();case 3:this.drawButtons();case 4:case"end":return e.stop()}},e,this)}))}},{key:"drawSilkscreen",value:function(){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m;case 2:t=e.sent,this.fillRect(0,160,160,60,"#bbb"),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(t,0,160*b,160*b,60*b);case 4:case"end":return e.stop()}},e,this)}))}},{key:"drawButtons",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.fillRect(0,220,160,30,"#d2d2d2"),t.includes(0)&&this.fillRect(0,220,30,30,"#777"),t.includes(1)&&this.fillRect(30,220,30,30,"#777"),t.includes(2)&&this.fillRect(100,220,30,30,"#777"),t.includes(3)&&this.fillRect(130,220,30,30,"#777"),t.includes(4)&&this.fillRect(60,220,40,15,"#777"),t.includes(5)&&this.fillRect(60,235,40,15,"#777"),this.ctx.beginPath(),this.ctx.lineWidth=Math.round(.5*b),this.ctx.strokeStyle="black",[[0,220,160,220],[30,220,30,250],[60,220,60,250],[130,220,130,250],[100,220,100,250],[60,235,100,235]].forEach(function(t){var i=n(t,4),r=i[0],o=i[1],a=i[2],s=i[3];e.ctx.moveTo(b*r,b*o),e.ctx.lineTo(b*a,b*s)}),this.ctx.stroke(),this.ctx.font=10*b+"px sans",this.ctx.fillStyle="black",this.textCenteredAt(15*b,235*b,"D"),this.textCenteredAt(45*b,235*b,"P"),this.textCenteredAt(115*b,235*b,"T"),this.textCenteredAt(145*b,235*b,"N")}},{key:"drawEmulationCanvas",value:function(e){this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(e,0,0,160*b,160*b)}},{key:"fillRect",value:function(e,t,n,i,r){this.ctx.beginPath(),this.ctx.rect(b*e,b*t,b*n,b*i),this.ctx.fillStyle=r,this.ctx.fill()}},{key:"textCenteredAt",value:function(e,t,n){var i=this.ctx.measureText(n);this.ctx.textBaseline="middle",this.ctx.fillText(n,e-i.width/2,t)}}]),e}(),w=a("8Y7J"),g=a("bucj"),y=a("sZkV"),k=((c=function(){function e(t){o(this,e),this.emulationService=t,this.onClick=function(){}}return s(e,[{key:"ngOnInit",value:function(){}},{key:"reset",value:function(){this.emulationService.reset(),this.onClick()}},{key:"resetNoExtensions",value:function(){this.emulationService.resetNoExtensions(),this.onClick()}},{key:"resetHard",value:function(){this.emulationService.resetHard(),this.onClick()}}]),e}()).\u0275fac=function(e){return new(e||c)(w.Jb(g.a))},c.\u0275cmp=w.Db({type:c,selectors:[["app-emulation-context-menu"]],inputs:{onClick:"onClick"},decls:7,vars:6,consts:[["button","",3,"detail","disabled","click"]],template:function(e,t){1&e&&(w.Mb(0,"ion-list"),w.Mb(1,"ion-item",0),w.Ub("click",function(){return t.reset()}),w.fc(2," Reset "),w.Lb(),w.Mb(3,"ion-item",0),w.Ub("click",function(){return t.resetNoExtensions()}),w.fc(4," Reset (no extensions) "),w.Lb(),w.Mb(5,"ion-item",0),w.Ub("click",function(){return t.resetHard()}),w.fc(6," Hard reset "),w.Lb(),w.Lb()),2&e&&(w.zb(1),w.Zb("detail",!1)("disabled",!t.emulationService.isRunning()),w.zb(2),w.Zb("detail",!1)("disabled",!t.emulationService.isRunning()),w.zb(2),w.Zb("detail",!1)("disabled",!t.emulationService.isRunning()))},directives:[y.m,y.h],styles:[""]}),c),x=function(){function e(n,i,r){var a=this;o(this,e),this.canvas=n,this.emulationService=i,this.canvasHelper=r,this.handleMouseDown=function(e){var n;if(0===e.button){var i=a.eventToPalmCoordinates(e);if(i){var r=a.determineArea(i);if(0===r)a.interactionMouse={area:r},(n=a.emulationService).handlePointerMove.apply(n,t(i));else{var o=a.determineButton(i);a.interactionMouse={area:r,button:o},a.emulationService.handleButtonDown(o),a.canvasHelper.drawButtons(a.activeButtons())}}}},this.handleMouseMove=function(e){var n,i;if(1&e.buttons&&0===(null===(i=a.interactionMouse)||void 0===i?void 0:i.area)){var r=a.eventToPalmCoordinates(e,!0);r&&(n=a.emulationService).handlePointerMove.apply(n,t(r))}},this.handeMouseUp=function(e){if(0===e.button){var t=a.interactionMouse;switch(a.interactionMouse=void 0,null==t?void 0:t.area){case 1:a.emulationService.handleButtonUp(t.button),a.canvasHelper.drawButtons(a.activeButtons());break;case 0:a.emulationService.handlePointerUp()}}},this.handleTouchStart=function(e){for(var n=0;n<e.changedTouches.length;n++){var i,r=e.changedTouches.item(n);if(r){var o=a.eventToPalmCoordinates(r);if(o){var s=a.determineArea(o);if(0===s)a.interactionsTouch.set(r.identifier,{area:s}),(i=a.emulationService).handlePointerMove.apply(i,t(o));else{var c=a.determineButton(o);a.interactionsTouch.set(r.identifier,{area:s,button:c}),a.emulationService.handleButtonDown(c),a.canvasHelper.drawButtons(a.activeButtons())}}}}!1!==e.cancelable&&e.preventDefault()},this.handleTouchMove=function(e){for(var n,i=0;i<e.changedTouches.length;i++){var r=e.changedTouches.item(i);if(r&&0===(null===(n=a.interactionsTouch.get(r.identifier))||void 0===n?void 0:n.area)){var o,s=a.eventToPalmCoordinates(r,!0);if(!s)continue;(o=a.emulationService).handlePointerMove.apply(o,t(s))}}!1!==e.cancelable&&e.preventDefault()},this.handleTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches.item(t);if(n){var i=a.interactionsTouch.get(n.identifier);switch(a.interactionsTouch.delete(n.identifier),null==i?void 0:i.area){case 1:a.emulationService.handleButtonUp(i.button),a.canvasHelper.drawButtons(a.activeButtons());break;case 0:a.emulationService.handlePointerUp()}}}!1!==e.cancelable&&e.preventDefault()},this.interactionsTouch=new Map,this.bound=!1}return s(e,[{key:"bind",value:function(){this.bound||(this.canvas.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mouseup",this.handeMouseUp),window.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.handleTouchEnd),this.canvas.addEventListener("touchcancel",this.handleTouchEnd),this.bound=!0)}},{key:"release",value:function(){this.bound&&(this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handeMouseUp),window.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd),this.bound=!1)}},{key:"eventToPalmCoordinates",value:function(e){var t,n,i,r,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.canvas.getBoundingClientRect();a.width/a.height>.64?(r=a.height,i=.64*a.height,n=a.top,t=a.left+(a.width-i)/2):(i=a.width,r=1.5625*a.width,t=a.left,n=a.top+(a.height-r)/2);var s=Math.floor((e.clientX-t)/i*160),c=Math.floor((e.clientY-n)/r*250);if(o)s<0&&(s=0),s>159&&(s=159),c<0&&(c=0),c>249&&(c=249);else if(s<0||s>=160||c<0||c>=250)return;return[s,c]}},{key:"determineArea",value:function(e){return n(e,2)[1]>=220?1:0}},{key:"determineButton",value:function(e){var t=n(e,2),i=t[0],r=t[1];return i>=130?3:i>=100?2:i>=60?r>=235?5:4:i>=30?1:0}},{key:"activeButtons",value:function(){var e,t=Array.from(this.interactionsTouch.values()).filter(function(e){return 1===e.area}).map(function(e){return e.button});return 1===(null===(e=this.interactionMouse)||void 0===e?void 0:e.area)&&t.push(this.interactionMouse.button),t}}]),e}(),S=a("hq03"),M=a("shLW"),T=["canvas"],E=[{path:"",component:(u=function(){function t(e,n,i,r,a,s){var c=this;o(this,t),this.emulationService=e,this.popoverController=n,this.alertService=i,this.fileService=r,this.loadingController=a,this.ngZone=s,this.onNewFrame=function(e){c.canvasHelper.drawEmulationCanvas(e)}}return s(t,[{key:"ngAfterViewInit",value:function(){var e=this.canvasRef.nativeElement;this.canvasHelper=new p(e),this.eventHandler=new x(e,this.emulationService,this.canvasHelper),this.canvasHelper.clear()}},{key:"canvasWidth",get:function(){return 160*b}},{key:"canvasHeight",get:function(){return 250*b}},{key:"powerButtonDown",value:function(){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emulationService.handleButtonDown(6);case 1:case"end":return e.stop()}},e,this)}))}},{key:"powerButtonUp",value:function(){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emulationService.handleButtonUp(6);case 1:case"end":return e.stop()}},e,this)}))}},{key:"ionViewDidEnter",value:function(){var e=this;this.emulationService.newFrame.addHandler(this.onNewFrame),this.emulationService.resume(),this.ngZone.runOutsideAngular(function(){return e.eventHandler.bind()})}},{key:"ionViewWillLeave",value:function(){this.emulationService.pause(),this.emulationService.newFrame.removeHandler(this.onNewFrame),this.eventHandler.release()}},{key:"openContextMenu",value:function(e){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverController.create({component:k,event:e,backdropDismiss:!0,showBackdrop:!1,componentProps:{onClick:function(){return n.dismiss()}}});case 2:(n=t.sent).present();case 4:case"end":return t.stop()}},t,this)}))}},{key:"installFiles",value:function(){this.fileService.openFiles(this.processFilesForInstallation.bind(this))}},{key:"installFileDisabled",get:function(){return!this.emulationService.isRunning()||this.emulationService.isPowerOff()||!this.emulationService.isUiInitialized()}},{key:"processFilesForInstallation",value:function(t){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,r,o,a,s,c,u,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadingController.create({message:"Installing..."});case 2:return(i=n.sent).present(),n.next=6,new Promise(function(e){return setTimeout(e,0)});case 6:r=[],o=[],n.prev=7,a=e(t),n.prev=9,a.s();case 11:if((s=a.n()).done){n.next=26;break}if(c=s.value,n.t0=/\.(prc|pdb)$/i.test(c.name),!n.t0){n.next=19;break}return n.next=17,this.emulationService.installFile(c.content);case 17:n.t1=n.sent,n.t0=0==n.t1;case 19:if(!n.t0){n.next=23;break}r.push(c.name),n.next=24;break;case 23:o.push(c.name);case 24:n.next=11;break;case 26:n.next=31;break;case 28:n.prev=28,n.t2=n.catch(9),a.e(n.t2);case 31:return n.prev=31,a.f(),n.finish(31);case 34:return n.prev=34,i.dismiss(),n.finish(34);case 37:n.t3=r.length,n.next=0===n.t3?40:1===n.t3?42:44;break;case 40:return u="",n.abrupt("break",45);case 42:return u="Installation of ".concat(r[0]," successful."),n.abrupt("break",45);case 44:u="Installation of ".concat(r.length," files successful.");case 45:n.t4=(o.length>0&&(u+="<br/><br/>"),o.length),n.next=0===n.t4?48:1===n.t4?49:51;break;case 48:return n.abrupt("break",52);case 49:return u+="Installation of ".concat(o[0]," failed."),n.abrupt("break",52);case 51:u+="Installation of ".concat(o.slice(0,o.length>3?3:o.length-1).join(", ")," and ").concat(o.length>3?o.length-3+" more files":o[o.length-1]," failed.");case 52:l=0===o.length?"Installation successful":0===r.length?"Installation failed":"Installation errors",this.alertService.message(l,u);case 53:case"end":return n.stop()}},n,this,[[7,,34,37],[9,28,31,34]])}))}}]),t}(),u.\u0275fac=function(e){return new(e||u)(w.Jb(g.a),w.Jb(y.w),w.Jb(S.a),w.Jb(M.a),w.Jb(y.v),w.Jb(w.B))},u.\u0275cmp=w.Db({type:u,selectors:[["app-emulation"]],viewQuery:function(e,t){var n;1&e&&w.jc(T,1),2&e&&w.ac(n=w.Vb())&&(t.canvasRef=n.first)},decls:18,vars:4,consts:[["slot","end"],[3,"disabled","mousedown","mouseup"],["name","power-outline"],[3,"disabled","click"],["name","add-outline"],["slot","start"],[3,"click"],["name","ellipsis-vertical-outline"],["name","checkmark-circle-outline"],[1,"container"],[3,"width","height"],["canvas",""]],template:function(e,t){1&e&&(w.Mb(0,"ion-header"),w.Mb(1,"ion-toolbar"),w.Mb(2,"ion-title"),w.fc(3,"Emulator"),w.Lb(),w.Mb(4,"ion-buttons",0),w.Mb(5,"ion-button",1),w.Ub("mousedown",function(){return t.powerButtonDown()})("mouseup",function(){return t.powerButtonUp()}),w.Kb(6,"ion-icon",2),w.Lb(),w.Mb(7,"ion-button",3),w.Ub("click",function(){return t.installFiles()}),w.Kb(8,"ion-icon",4),w.Lb(),w.Lb(),w.Mb(9,"ion-buttons",5),w.Mb(10,"ion-button",6),w.Ub("click",function(e){return t.openContextMenu(e)}),w.Kb(11,"ion-icon",7),w.Lb(),w.Mb(12,"ion-button"),w.Kb(13,"ion-icon",8),w.Lb(),w.Lb(),w.Lb(),w.Lb(),w.Mb(14,"ion-content"),w.Mb(15,"div",9),w.Kb(16,"canvas",10,11),w.Lb(),w.Lb()),2&e&&(w.zb(5),w.Zb("disabled",!t.emulationService.isRunning()),w.zb(2),w.Zb("disabled",t.installFileDisabled),w.zb(9),w.Zb("width",t.canvasWidth)("height",t.canvasHeight))},directives:[y.f,y.s,y.r,y.d,y.c,y.g,y.e],styles:["ion-title[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding:5px;background:#000}canvas[_ngcontent-%COMP%]{max-width:100%;max-height:100%;height:750px;width:480px;-o-object-fit:contain;object-fit:contain}"]}),u)}],C=((l=function e(){o(this,e)}).\u0275mod=w.Hb({type:l}),l.\u0275inj=w.Gb({factory:function(e){return new(e||l)},imports:[[v.i.forChild(E)],v.i]}),l),R=a("s7LF"),L=((h=function e(){o(this,e)}).\u0275mod=w.Hb({type:h}),h.\u0275inj=w.Gb({factory:function(e){return new(e||h)},imports:[[d.b,R.a,y.t,C]]}),h)}}])}();