!function(){function e(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(c){r=!0,a=c}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"6aA7":function(i,r,o){"use strict";o.r(r),o.d(r,"EmulationPageModule",function(){return W});var c=o("ofXK"),u=o("tyNb"),l=o("mrSG"),h=o("z9fa"),d=o("bucj"),v=d.b[2],f=d.b[0],b=3*devicePixelRatio,m=Math.round(1*b),p=160*b+2*m,g=251*b+2*m;function w(e){return new Promise(function(t,n){var i=new Image;i.onload=function(){return t(i)},i.onerror=function(){return n()},i.src=e})}function y(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((n=document.createElement("canvas")).width=160*b,n.height=30*b,i=n.getContext("2d")){t.next=5;break}throw new Error("get a new browser");case 5:return t.t0=i,t.next=8,w(e);case 8:return t.t1=t.sent,t.t2=160*b,t.t3=30*b,t.t0.drawImage.call(t.t0,t.t1,0,0,t.t2,t.t3),t.abrupt("return",n);case 13:case"end":return t.stop()}},t)}))}var k,S=w("assets/silkscreen-default.svg"),x=w("assets/silkscreen-m515.svg"),M=y("assets/hard-buttons-default.svg"),C=y("assets/hard-buttons-m515.svg"),R=function(){function e(t){a(this,e),this.canvas=t;var n=t.getContext("2d");if(!n)throw new Error("get a new browser");this.ctx=n}return s(e,[{key:"clear",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.session=e,this.fillCanvasRect(0,0,p,g,this.backgroundColor()),t.next=4,this.drawSilkscreen();case 4:return t.next=6,this.drawButtons();case 6:case"end":return t.stop()}},t,this)}))}},{key:"drawSilkscreen",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.silkscreenImage();case 2:t=e.sent,this.fillRect(0,161,160,60,v),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.drawImage(t,m,m+161*b,160*b,60*b);case 4:case"end":return e.stop()}},e,this)}))}},{key:"drawButtons",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.ctx,t.next=3,this.buttonsImage();case 3:t.t1=t.sent,t.t2=m,t.t3=m+221*b,t.t4=160*b,t.t5=30*b,t.t0.drawImage.call(t.t0,t.t1,t.t2,t.t3,t.t4,t.t5),e.includes(0)&&this.fillRect(0,221,30,30,"rgba(0,0,0,0.2)"),e.includes(1)&&this.fillRect(30,221,30,30,"rgba(0,0,0,0.2)"),e.includes(2)&&this.fillRect(100,221,30,30,"rgba(0,0,0,0.2)"),e.includes(3)&&this.fillRect(130,221,30,30,"rgba(0,0,0,0.2)"),e.includes(4)&&this.fillRect(60,221,40,15,"rgba(0,0,0,0.2)"),e.includes(5)&&this.fillRect(60,236,40,15,"rgba(0,0,0,0.2)");case 15:case"end":return t.stop()}},t,this)}))}},{key:"drawEmulationCanvas",value:function(e){this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(e,m,m,160*b,160*b)}},{key:"fillRect",value:function(e,t,n,i,r){this.ctx.beginPath(),this.ctx.rect(m+b*e,m+b*t,b*n,b*i),this.ctx.fillStyle=r,this.ctx.fill()}},{key:"fillCanvasRect",value:function(e,t,n,i,r){this.ctx.beginPath(),this.ctx.rect(e,t,n,i),this.ctx.fillStyle=r,this.ctx.fill()}},{key:"textCenteredAt",value:function(e,t,n){var i=this.ctx.measureText(n);this.ctx.textBaseline="middle",this.ctx.fillText(n,m+b*e-i.width/2,m+b*t)}},{key:"silkscreenImage",value:function(){var e;switch(null===(e=this.session)||void 0===e?void 0:e.device){case h.a.m515:return x;default:return S}}},{key:"buttonsImage",value:function(){var e;switch(null===(e=this.session)||void 0===e?void 0:e.device){case h.a.m515:return C;default:return M}}},{key:"backgroundColor",value:function(){var e;switch(null===(e=this.session)||void 0===e?void 0:e.device){case h.a.m515:return"white";default:return f}}}]),e}(),E=o("oOyw"),T=o("fXoL"),L=o("TEn/"),I=((k=function(){function e(t){a(this,e),this.emulationService=t,this.onClick=function(){}}return s(e,[{key:"ngOnInit",value:function(){}},{key:"reset",value:function(){this.emulationService.reset(),this.onClick()}},{key:"resetNoExtensions",value:function(){this.emulationService.resetNoExtensions(),this.onClick()}},{key:"resetHard",value:function(){this.emulationService.resetHard(),this.onClick()}}]),e}()).\u0275fac=function(e){return new(e||k)(T.Jb(d.a))},k.\u0275cmp=T.Db({type:k,selectors:[["app-emulation-context-menu"]],inputs:{onClick:"onClick"},decls:7,vars:6,consts:[["button","",3,"detail","disabled","click"]],template:function(e,t){1&e&&(T.Mb(0,"ion-list"),T.Mb(1,"ion-item",0),T.Ub("click",function(){return t.reset()}),T.gc(2," Reset "),T.Lb(),T.Mb(3,"ion-item",0),T.Ub("click",function(){return t.resetNoExtensions()}),T.gc(4," Reset (no extensions) "),T.Lb(),T.Mb(5,"ion-item",0),T.Ub("click",function(){return t.resetHard()}),T.gc(6," Hard reset "),T.Lb(),T.Lb()),2&e&&(T.zb(1),T.Zb("detail",!1)("disabled",!t.emulationService.isRunning()),T.zb(2),T.Zb("detail",!1)("disabled",!t.emulationService.isRunning()),T.zb(2),T.Zb("detail",!1)("disabled",!t.emulationService.isRunning()))},directives:[L.m,L.h],styles:[""]}),k),B=function(){function e(t,i,r){var o=this;a(this,e),this.canvas=t,this.emulationService=i,this.canvasHelper=r,this.handleMouseDown=function(e){var t;if(0===e.button){var i=o.eventToPalmCoordinates(e);if(i){var r=o.determineArea(i);if(0===r)o.interactionMouse={area:r},(t=o.emulationService).handlePointerMove.apply(t,n(i));else{var a=o.determineButton(i);o.interactionMouse={area:r,button:a},o.emulationService.handleButtonDown(a),o.canvasHelper.drawButtons(o.activeButtons())}}}},this.handleMouseMove=function(e){var t,i;if(1&e.buttons&&0===(null===(i=o.interactionMouse)||void 0===i?void 0:i.area)){var r=o.eventToPalmCoordinates(e,!0);r&&(t=o.emulationService).handlePointerMove.apply(t,n(r))}},this.handeMouseUp=function(e){if(0===e.button){var t=o.interactionMouse;switch(o.interactionMouse=void 0,null==t?void 0:t.area){case 1:o.emulationService.handleButtonUp(t.button),o.canvasHelper.drawButtons(o.activeButtons());break;case 0:o.emulationService.handlePointerUp()}}},this.handleTouchStart=function(e){for(var t=0;t<e.changedTouches.length;t++){var i,r=e.changedTouches.item(t);if(r){var a=o.eventToPalmCoordinates(r);if(a){var s=o.determineArea(a);if(0===s)o.interactionsTouch.set(r.identifier,{area:s}),(i=o.emulationService).handlePointerMove.apply(i,n(a));else{var c=o.determineButton(a);o.interactionsTouch.set(r.identifier,{area:s,button:c}),o.emulationService.handleButtonDown(c),o.canvasHelper.drawButtons(o.activeButtons())}}}}!1!==e.cancelable&&e.preventDefault()},this.handleTouchMove=function(e){for(var t,i=0;i<e.changedTouches.length;i++){var r=e.changedTouches.item(i);if(r&&0===(null===(t=o.interactionsTouch.get(r.identifier))||void 0===t?void 0:t.area)){var a,s=o.eventToPalmCoordinates(r,!0);if(!s)continue;(a=o.emulationService).handlePointerMove.apply(a,n(s))}}!1!==e.cancelable&&e.preventDefault()},this.handleTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches.item(t);if(n){var i=o.interactionsTouch.get(n.identifier);switch(o.interactionsTouch.delete(n.identifier),null==i?void 0:i.area){case 1:o.emulationService.handleButtonUp(i.button),o.canvasHelper.drawButtons(o.activeButtons());break;case 0:o.emulationService.handlePointerUp()}}}!1!==e.cancelable&&e.preventDefault()},this.interactionsTouch=new Map,this.bound=!1}return s(e,[{key:"bind",value:function(){this.bound||(this.canvas.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mouseup",this.handeMouseUp),window.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("touchstart",this.handleTouchStart),this.canvas.addEventListener("touchmove",this.handleTouchMove),this.canvas.addEventListener("touchend",this.handleTouchEnd),this.canvas.addEventListener("touchcancel",this.handleTouchEnd),this.bound=!0)}},{key:"release",value:function(){this.bound&&(this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handeMouseUp),window.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchend",this.handleTouchEnd),this.canvas.removeEventListener("touchcancel",this.handleTouchEnd),this.bound=!1)}},{key:"eventToPalmCoordinates",value:function(e){var t,n,i,r,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this.canvas.getBoundingClientRect();o.width/o.height>p/g?(r=o.height,i=p/g*o.height,n=o.top,t=o.left+(o.width-i)/2):(i=o.width,r=g/p*o.width,t=o.left,n=o.top+(o.height-r)/2);var s=Math.floor((e.clientX-t)/i*p/b)-m/b,c=Math.floor((e.clientY-n)/r*g/b)-m/b;if(c>=161&&(c-=1),a)s<0&&(s=0),s>159&&(s=159),c<0&&(c=0),c>249&&(c=249);else if(s<0||s>=160||c<0||c>=250)return;return[s,c]}},{key:"determineArea",value:function(e){return t(e,2)[1]>=220?1:0}},{key:"determineButton",value:function(e){var n=t(e,2),i=n[0],r=n[1];return i>=130?3:i>=100?2:i>=60?r>=236?5:4:i>=30?1:0}},{key:"activeButtons",value:function(){var e,t=Array.from(this.interactionsTouch.values()).filter(function(e){return 1===e.area}).map(function(e){return e.button});return 1===(null===(e=this.interactionMouse)||void 0===e?void 0:e.area)&&t.push(this.interactionMouse.button),t}}]),e}(),P=o("Ld/c"),j=o("xOb2"),H=o("hq03"),O=o("shLW"),A=["canvas"];function U(e,t){1&e&&(T.Mb(0,"div",12),T.Mb(1,"div"),T.gc(2,"No session selected"),T.Lb(),T.Lb())}var D,F,z,J=[{path:"",component:(D=function(){function t(e,n,i,r,o,s,c,u){var l=this;a(this,t),this.emulationService=e,this.emulationState=n,this.storageService=i,this.popoverController=r,this.alertService=o,this.fileService=s,this.loadingController=c,this.ngZone=u,this.onNewFrame=function(e){l.canvasHelper.drawEmulationCanvas(e)}}return s(t,[{key:"ngAfterViewInit",value:function(){var e=this.canvasRef.nativeElement;this.canvasHelper=new R(e),this.eventHandler=new B(e,this.emulationService,this.canvasHelper)}},{key:"canvasWidth",get:function(){return p}},{key:"canvasHeight",get:function(){return g}},{key:"cssWidth",get:function(){return this.canvasWidth/devicePixelRatio+"px"}},{key:"cssHeight",get:function(){return this.canvasHeight/devicePixelRatio+"px"}},{key:"powerButtonDown",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emulationService.handleButtonDown(6);case 1:case"end":return e.stop()}},e,this)}))}},{key:"powerButtonUp",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.emulationService.handleButtonUp(6);case 1:case"end":return e.stop()}},e,this)}))}},{key:"ionViewDidEnter",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.emulationState.getCurrentSession(),n=Object(E.b)(),e.t0=t||void 0===n,e.t0){e.next=7;break}return e.next=6,this.storageService.getSession(n);case 6:t=e.sent;case 7:this.canvasHelper.clear(t),this.onNewFrame(this.emulationService.getCanvas()),this.emulationService.newFrame.addHandler(this.onNewFrame),this.emulationService.resume(),this.ngZone.runOutsideAngular(function(){return i.eventHandler.bind()});case 12:case"end":return e.stop()}},e,this)}))}},{key:"ionViewWillLeave",value:function(){this.emulationService.pause(),this.emulationService.newFrame.removeHandler(this.onNewFrame),this.eventHandler.release()}},{key:"openContextMenu",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverController.create({component:I,event:e,backdropDismiss:!0,showBackdrop:!1,componentProps:{onClick:function(){return n.dismiss()}}});case 2:(n=t.sent).present();case 4:case"end":return t.stop()}},t,this)}))}},{key:"installFiles",value:function(){this.fileService.openFiles(this.processFilesForInstallation.bind(this))}},{key:"installFileDisabled",get:function(){return!this.emulationService.isRunning()||this.emulationService.isPowerOff()||!this.emulationService.isUiInitialized()}},{key:"title",get:function(){var e;return(null===(e=this.emulationState.getCurrentSession())||void 0===e?void 0:e.name)||""}},{key:"processFilesForInstallation",value:function(t){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,r,a,o,s,c,u,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadingController.create({message:"Installing..."});case 2:return i=n.sent,n.next=5,i.present();case 5:r=[],a=[],n.prev=6,o=e(t),n.prev=8,o.s();case 10:if((s=o.n()).done){n.next=25;break}if(c=s.value,n.t0=/\.(prc|pdb)$/i.test(c.name),!n.t0){n.next=18;break}return n.next=16,this.emulationService.installFile(c.content);case 16:n.t1=n.sent,n.t0=0==n.t1;case 18:if(!n.t0){n.next=22;break}r.push(c.name),n.next=23;break;case 22:a.push(c.name);case 23:n.next=10;break;case 25:n.next=30;break;case 27:n.prev=27,n.t2=n.catch(8),o.e(n.t2);case 30:return n.prev=30,o.f(),n.finish(30);case 33:return n.prev=33,i.dismiss(),n.finish(33);case 36:n.t3=r.length,n.next=0===n.t3?39:1===n.t3?41:43;break;case 39:return u="",n.abrupt("break",44);case 41:return u="Installation of ".concat(r[0]," successful."),n.abrupt("break",44);case 43:u="Installation of ".concat(r.length," files successful.");case 44:n.t4=(a.length>0&&(u+="<br/><br/>"),a.length),n.next=0===n.t4?47:1===n.t4?48:50;break;case 47:return n.abrupt("break",51);case 48:return u+="Installation of ".concat(a[0]," failed."),n.abrupt("break",51);case 50:u+="Installation of ".concat(a.slice(0,a.length>3?3:a.length-1).join(", ")," and ").concat(a.length>3?a.length-3+" more files":a[a.length-1]," failed.");case 51:l=0===a.length?"Installation successful":0===r.length?"Installation failed":"Installation errors",this.alertService.message(l,u);case 52:case"end":return n.stop()}},n,this,[[6,,33,36],[8,27,30,33]])}))}}]),t}(),D.\u0275fac=function(e){return new(e||D)(T.Jb(d.a),T.Jb(P.a),T.Jb(j.b),T.Jb(L.w),T.Jb(H.a),T.Jb(O.a),T.Jb(L.v),T.Jb(T.B))},D.\u0275cmp=T.Db({type:D,selectors:[["app-emulation"]],viewQuery:function(e,t){var n;1&e&&T.kc(A,1),2&e&&T.ac(n=T.Vb())&&(t.canvasRef=n.first)},decls:17,vars:14,consts:[["slot","end"],[3,"disabled","mousedown","mouseup"],["name","power-outline"],[3,"disabled","click"],["name","download-outline"],["slot","start"],[3,"click"],["name","ellipsis-vertical-outline"],[1,"container","running-session"],[3,"width","height"],["canvas",""],["class","container no-session",4,"ngIf"],[1,"container","no-session"]],template:function(e,t){1&e&&(T.Mb(0,"ion-header"),T.Mb(1,"ion-toolbar"),T.Mb(2,"ion-title"),T.gc(3),T.Lb(),T.Mb(4,"ion-buttons",0),T.Mb(5,"ion-button",1),T.Ub("mousedown",function(){return t.powerButtonDown()})("mouseup",function(){return t.powerButtonUp()}),T.Kb(6,"ion-icon",2),T.Lb(),T.Mb(7,"ion-button",3),T.Ub("click",function(){return t.installFiles()}),T.Kb(8,"ion-icon",4),T.Lb(),T.Lb(),T.Mb(9,"ion-buttons",5),T.Mb(10,"ion-button",6),T.Ub("click",function(e){return t.openContextMenu(e)}),T.Kb(11,"ion-icon",7),T.Lb(),T.Lb(),T.Lb(),T.Lb(),T.Mb(12,"ion-content"),T.Mb(13,"div",8),T.Kb(14,"canvas",9,10),T.Lb(),T.fc(16,U,3,0,"div",11),T.Lb()),2&e&&(T.zb(3),T.hc(t.title),T.zb(2),T.Zb("disabled",!t.emulationService.isRunning()),T.zb(2),T.Zb("disabled",t.installFileDisabled),T.zb(6),T.ec("display",t.emulationState.getCurrentSession()?void 0:"none"),T.zb(1),T.ec("width",t.cssWidth)("height",t.cssHeight)("display",t.emulationState.getCurrentSession()?"block":"none"),T.Zb("width",t.canvasWidth)("height",t.canvasHeight),T.zb(2),T.Zb("ngIf",!t.emulationState.getCurrentSession()))},directives:[L.f,L.s,L.r,L.d,L.c,L.g,L.e,c.i],styles:["ion-title[_ngcontent-%COMP%]{text-align:center}.container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;padding:3px}@media (prefers-color-scheme:light){.container.running-session[_ngcontent-%COMP%]{background:#a8a8a8}}canvas[_ngcontent-%COMP%]{max-width:100%;max-height:100%;-o-object-fit:contain;object-fit:contain}"]}),D)}],N=((F=function e(){a(this,e)}).\u0275mod=T.Hb({type:F}),F.\u0275inj=T.Gb({factory:function(e){return new(e||F)},imports:[[u.i.forChild(J)],u.i]}),F),Z=o("3Pt+"),W=((z=function e(){a(this,e)}).\u0275mod=T.Hb({type:z}),z.\u0275inj=T.Gb({factory:function(e){return new(e||z)},imports:[[c.b,Z.a,L.t,N]]}),z)}}])}();