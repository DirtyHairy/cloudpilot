!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"/NlI":function(n,i,o){"use strict";o.r(i),o.d(i,"SessionsPageModule",function(){return C});var s,r,a=o("SVse"),c=o("s7LF"),u=o("sZkV"),l=o("iInd"),d=o("mrSG"),m=o("8Y7J"),b=o("bucj"),f=o("xOb2"),p=((s=function(){function n(t,i){e(this,n),this.emulationService=t,this.storageService=i,this.sessions=[],this.updateSessionsFromStorage()}return t(n,[{key:"addSessionFromImage",value:function(e,n){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={id:-1,name:n,device:e.deviceId,ram:e.memory.length/1024/1024,rom:""},t.next=3,this.storageService.addSession(i,e.rom);case 3:this.updateSessionsFromStorage();case 4:case"end":return t.stop()}},t,this)}))}},{key:"addSessionFromRom",value:function(e,n,t){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function i(){var o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=-1,i.t1=n,i.t2=t,i.next=5,this.emulationService.cloudpilot;case 5:return i.t3=i.sent.minRamForDevice(t),i.t4=i.t3/1024,i.t5=i.t4/1024,o={id:i.t0,name:i.t1,device:i.t2,ram:i.t5,rom:""},i.next=11,this.storageService.addSession(o,e);case 11:this.updateSessionsFromStorage();case 12:case"end":return i.stop()}},i,this)}))}},{key:"getSessions",value:function(){return this.sessions}},{key:"deleteSession",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.storageService.deleteSession(e);case 2:this.updateSessionsFromStorage();case 3:case"end":return n.stop()}},n,this)}))}},{key:"updateSession",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.storageService.updateSession(e);case 2:this.updateSessionsFromStorage();case 3:case"end":return n.stop()}},n,this)}))}},{key:"updateSessionsFromStorage",value:function(){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getAllSessions();case 2:this.sessions=e.sent.sort(function(e,n){return e.name.localeCompare(n.name)});case 3:case"end":return e.stop()}},e,this)}))}}]),n}()).\u0275fac=function(e){return new(e||s)(m.Qb(b.a),m.Qb(f.a))},s.\u0275prov=m.Fb({token:s,factory:s.\u0275fac,providedIn:"root"}),s),v=o("shLW"),h=o("hq03"),g=((r=function(){function n(){e(this,n),this.onEdit=function(){},this.onSave=function(){},this.onDelete=function(){}}return t(n,[{key:"ngOnInit",value:function(){}}]),n}()).\u0275fac=function(e){return new(e||r)},r.\u0275cmp=m.Db({type:r,selectors:[["app-session-context-menu"]],inputs:{onEdit:"onEdit",onSave:"onSave",onDelete:"onDelete"},decls:10,vars:3,consts:[["button","",3,"detail","click"],["name","create-outline","slot","end"],["name","download-outline","slot","end"],["name","trash-outline","slot","end"]],template:function(e,n){1&e&&(m.Mb(0,"ion-list"),m.Mb(1,"ion-item",0),m.Ub("click",function(){return n.onEdit()}),m.fc(2," Edit "),m.Kb(3,"ion-icon",1),m.Lb(),m.Mb(4,"ion-item",0),m.Ub("click",function(){return n.onSave()}),m.fc(5," Save "),m.Kb(6,"ion-icon",2),m.Lb(),m.Mb(7,"ion-item",0),m.Ub("click",function(){return n.onDelete()}),m.fc(8," Delete "),m.Kb(9,"ion-icon",3),m.Lb(),m.Lb()),2&e&&(m.zb(1),m.Zb("detail",!1),m.zb(3),m.Zb("detail",!1),m.zb(3),m.Zb("detail",!1))},directives:[u.m,u.h,u.g],styles:[""]}),r),S=o("z9fa");function k(e,n){if(1&e&&(m.Mb(0,"span"),m.fc(1),m.Lb()),2&e){var t=m.Wb();m.zb(1),m.hc(", OS ",null==t.session?null:t.session.osVersion,"")}}var w,y=((w=function(){function n(t){e(this,n),this.popoverController=t,this.selected=!1,this.delete=new m.o,this.edit=new m.o,this.save=new m.o,this.selectItem=new m.o}return t(n,[{key:"device",get:function(){var e;switch(null===(e=this.session)||void 0===e?void 0:e.device){case S.a.m515:return"Palm m515";case S.a.palmV:return"Palm V";default:throw new Error("bad device ID")}}},{key:"onContextmenu",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t,i=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.stopPropagation(),e.preventDefault(),n.next=3,this.popoverController.create({component:g,event:e,backdropDismiss:!0,showBackdrop:!1,componentProps:{onEdit:function(){t.dismiss(),i.edit.emit()},onSave:function(){t.dismiss(),i.save.emit()},onDelete:function(){t.dismiss(),i.delete.emit()}}});case 3:(t=n.sent).present();case 5:case"end":return n.stop()}},n,this)}))}}]),n}()).\u0275fac=function(e){return new(e||w)(m.Jb(u.w))},w.\u0275cmp=m.Db({type:w,selectors:[["app-session-item"]],inputs:{session:"session",selected:"selected"},outputs:{delete:"delete",edit:"edit",save:"save",selectItem:"selectItem"},decls:16,vars:5,consts:[[3,"contextmenu"],["side","start"],["color","primary","icon-only","",3,"click"],["name","create-outline"],["color","secondary","icon-only","",3,"click"],["name","download-outline"],["side","end"],["color","danger","icon-only","",3,"click"],["name","trash-outline"],[3,"color","click"],[4,"ngIf"]],template:function(e,n){1&e&&(m.Mb(0,"ion-item-sliding",0),m.Ub("contextmenu",function(e){return n.onContextmenu(e)}),m.Mb(1,"ion-item-options",1),m.Mb(2,"ion-item-option",2),m.Ub("click",function(){return n.edit.emit(n.session)}),m.Kb(3,"ion-icon",3),m.Lb(),m.Mb(4,"ion-item-option",4),m.Ub("click",function(){return n.save.emit(n.session)}),m.Kb(5,"ion-icon",5),m.Lb(),m.Lb(),m.Mb(6,"ion-item-options",6),m.Mb(7,"ion-item-option",7),m.Ub("click",function(){return n.delete.emit(n.session)}),m.Kb(8,"ion-icon",8),m.Lb(),m.Lb(),m.Mb(9,"ion-item",9),m.Ub("click",function(){return n.selectItem.emit()}),m.Mb(10,"ion-label"),m.Mb(11,"h2"),m.fc(12),m.Lb(),m.Mb(13,"p"),m.fc(14),m.ec(15,k,2,1,"span",10),m.Lb(),m.Lb(),m.Lb(),m.Lb()),2&e&&(m.zb(9),m.Zb("color",n.selected?"primary":void 0),m.zb(3),m.gc(null==n.session?null:n.session.name),m.zb(2),m.ic("",n.device," ",null==n.session?null:n.session.ram,"MB RAM"),m.zb(1),m.Zb("ngIf",null==n.session?null:n.session.osVersion))},directives:[u.k,u.j,u.i,u.g,u.h,u.l,a.i],styles:["ion-label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin-top:.75em}ion-item-option[_ngcontent-%COMP%]{font-size:1.5em}ion-item-sliding[_ngcontent-%COMP%]{cursor:pointer}"]}),w);function x(e,n){if(1&e){var t=m.Nb();m.Mb(0,"app-session-item",6),m.Ub("delete",function(){m.bc(t);var e=n.$implicit;return m.Wb().deleteSession(e)})("selectItem",function(){m.bc(t);var e=n.$implicit;return m.Wb().launchSession(e)})("edit",function(){m.bc(t);var e=n.$implicit;return m.Wb().editSession(e)}),m.Lb()}if(2&e){var i,o=n.$implicit,s=m.Wb();m.Zb("session",o)("selected",(null==(i=s.emulationService.getCurrentSession())?null:i.id)===o.id)}}var M,L,R,O=[{path:"",component:(M=function(){function n(t,i,o,s,r,a){e(this,n),this.sessionService=t,this.fileService=i,this.alertController=o,this.alertService=s,this.emulationService=r,this.router=a}return t(n,[{key:"sessions",get:function(){return this.sessionService.getSessions().sort(function(e,n){return e.name.localeCompare(n.name)})}},{key:"deleteSession",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t,i=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({header:"Warning",message:"Deleting the session '".concat(e.name,"' will remove all associated data. This cannot be undone. Are you sure you want to continue?"),buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:function(){return i.sessionService.deleteSession(e)}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}},n,this)}))}},{key:"editSession",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.queryName(e.name);case 2:void 0!==(t=n.sent)&&this.sessionService.updateSession(Object.assign(Object.assign({},e),{name:t}));case 4:case"end":return n.stop()}},n,this)}))}},{key:"loadFile",value:function(){this.fileService.openFile(this.processFile.bind(this))}},{key:"launchSession",value:function(e){this.emulationService.switchSession(e.id),this.router.navigateByUrl("/tab/emulation")}},{key:"processFile",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark(function n(){var t,i,o,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(/\.(img|rom|bin)$/i.test(e.name)){n.next=2;break}return n.abrupt("return",void this.alertService.errorMessage("Unsupported file suffix. Supported suffixes are .bin, .img and .rom."));case 2:if(!(t=this.fileService.parseSessionImage(e.content))){n.next=10;break}return n.next=6,this.queryName(e.name);case 6:void 0!==(i=n.sent)&&this.sessionService.addSessionFromImage(t,i),n.next=21;break;case 10:return n.next=12,this.emulationService.cloudpilot;case 12:if(o=n.sent.getRomInfo(e.content)){n.next=15;break}return n.abrupt("return",void this.alertService.errorMessage("Not a valid session file or ROM image."));case 15:if(0!==o.supportedDevices.length){n.next=17;break}return n.abrupt("return",void this.alertService.errorMessage("No supported device for this ROM."));case 17:return n.next=19,this.queryName(e.name);case 19:void 0!==(s=n.sent)&&this.sessionService.addSessionFromRom(e.content,s,o.supportedDevices[0]);case 21:case"end":return n.stop()}},n,this)}))}},{key:"queryName",value:function(e){var n=this;return new Promise(function(t){return Object(d.a)(n,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({header:"Session Name",inputs:[{type:"textarea",name:"name",placeholder:"Session name",value:e,label:"Name"}],buttons:[{text:"Cancel",role:"cancel",handler:function(){return t(void 0)}},{text:"Continue",handler:function(e){return t(e.name)}}]});case 2:n.sent.present();case 3:case"end":return n.stop()}},n,this)}))})}}]),n}(),M.\u0275fac=function(e){return new(e||M)(m.Jb(p),m.Jb(v.a),m.Jb(u.a),m.Jb(h.a),m.Jb(b.a),m.Jb(l.g))},M.\u0275cmp=m.Db({type:M,selectors:[["app-sessions"]],decls:14,vars:1,consts:[["slot","primary"],[3,"click"],["name","add-outline"],["collapse","condense"],["size","large"],[3,"session","selected","delete","selectItem","edit",4,"ngFor","ngForOf"],[3,"session","selected","delete","selectItem","edit"]],template:function(e,n){1&e&&(m.Mb(0,"ion-header"),m.Mb(1,"ion-toolbar"),m.Mb(2,"ion-title"),m.fc(3,"Sessions"),m.Lb(),m.Mb(4,"ion-buttons",0),m.Mb(5,"ion-button",1),m.Ub("click",function(){return n.loadFile()}),m.Kb(6,"ion-icon",2),m.Lb(),m.Lb(),m.Lb(),m.Lb(),m.Mb(7,"ion-content"),m.Mb(8,"ion-header",3),m.Mb(9,"ion-toolbar"),m.Mb(10,"ion-title",4),m.fc(11,"Sessions"),m.Lb(),m.Lb(),m.Lb(),m.Mb(12,"ion-list"),m.ec(13,x,1,2,"app-session-item",5),m.Lb(),m.Lb()),2&e&&(m.zb(13),m.Zb("ngForOf",n.sessions))},directives:[u.f,u.s,u.r,u.d,u.c,u.g,u.e,u.m,a.h,y],styles:[""]}),M)}],F=((R=function n(){e(this,n)}).\u0275mod=m.Hb({type:R}),R.\u0275inj=m.Gb({factory:function(e){return new(e||R)},imports:[[l.i.forChild(O)],l.i]}),R),C=((L=function n(){e(this,n)}).\u0275mod=m.Hb({type:L}),L.\u0275inj=m.Gb({factory:function(e){return new(e||L)},imports:[[a.b,c.a,u.t,F]]}),L)}}])}();