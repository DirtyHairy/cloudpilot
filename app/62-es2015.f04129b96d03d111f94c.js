(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"/NlI":function(e,t,i){"use strict";i.r(t),i.d(t,"SessionsPageModule",function(){return M});var n=i("SVse"),s=i("s7LF"),o=i("sZkV"),r=i("iInd"),c=i("mrSG"),l=i("8Y7J"),a=i("bucj"),d=i("xOb2");let u=(()=>{class e{constructor(e,t){this.emulationService=e,this.storageService=t,this.sessions=[],this.updateSessionsFromStorage()}addSessionFromImage(e,t){return Object(c.a)(this,void 0,void 0,function*(){const i={id:-1,name:t,device:e.deviceId,ram:e.memory.length/1024/1024,rom:""};yield this.storageService.addSession(i,e.rom),this.updateSessionsFromStorage()})}addSessionFromRom(e,t,i){return Object(c.a)(this,void 0,void 0,function*(){const n={id:-1,name:t,device:i,ram:(yield this.emulationService.cloudpilot).minRamForDevice(i)/1024/1024,rom:""};yield this.storageService.addSession(n,e),this.updateSessionsFromStorage()})}getSessions(){return this.sessions}deleteSession(e){return Object(c.a)(this,void 0,void 0,function*(){yield this.storageService.deleteSession(e),this.updateSessionsFromStorage()})}updateSession(e){return Object(c.a)(this,void 0,void 0,function*(){yield this.storageService.updateSession(e),this.updateSessionsFromStorage()})}updateSessionsFromStorage(){return Object(c.a)(this,void 0,void 0,function*(){this.sessions=(yield this.storageService.getAllSessions()).sort((e,t)=>e.name.localeCompare(t.name))})}}return e.\u0275fac=function(t){return new(t||e)(l.Qb(a.a),l.Qb(d.a))},e.\u0275prov=l.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=i("shLW"),m=i("hq03");let p=(()=>{class e{constructor(){this.onEdit=()=>{},this.onSave=()=>{},this.onDelete=()=>{}}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Db({type:e,selectors:[["app-session-context-menu"]],inputs:{onEdit:"onEdit",onSave:"onSave",onDelete:"onDelete"},decls:10,vars:3,consts:[["button","",3,"detail","click"],["name","create-outline","slot","end"],["name","download-outline","slot","end"],["name","trash-outline","slot","end"]],template:function(e,t){1&e&&(l.Mb(0,"ion-list"),l.Mb(1,"ion-item",0),l.Ub("click",function(){return t.onEdit()}),l.fc(2," Edit "),l.Kb(3,"ion-icon",1),l.Lb(),l.Mb(4,"ion-item",0),l.Ub("click",function(){return t.onSave()}),l.fc(5," Save "),l.Kb(6,"ion-icon",2),l.Lb(),l.Mb(7,"ion-item",0),l.Ub("click",function(){return t.onDelete()}),l.fc(8," Delete "),l.Kb(9,"ion-icon",3),l.Lb(),l.Lb()),2&e&&(l.zb(1),l.Zb("detail",!1),l.zb(3),l.Zb("detail",!1),l.zb(3),l.Zb("detail",!1))},directives:[o.m,o.h,o.g],styles:[""]}),e})();var h=i("z9fa");function v(e,t){if(1&e&&(l.Mb(0,"span"),l.fc(1),l.Lb()),2&e){const e=l.Wb();l.zb(1),l.hc(", OS ",null==e.session?null:e.session.osVersion,"")}}let f=(()=>{class e{constructor(e){this.popoverController=e,this.selected=!1,this.delete=new l.o,this.edit=new l.o,this.save=new l.o,this.selectItem=new l.o}get device(){var e;switch(null===(e=this.session)||void 0===e?void 0:e.device){case h.a.m515:return"Palm m515";case h.a.palmV:return"Palm V";default:throw new Error("bad device ID")}}onContextmenu(e){return Object(c.a)(this,void 0,void 0,function*(){e.stopPropagation(),e.preventDefault();const t=yield this.popoverController.create({component:p,event:e,backdropDismiss:!0,showBackdrop:!1,componentProps:{onEdit:()=>{t.dismiss(),this.edit.emit()},onSave:()=>{t.dismiss(),this.save.emit()},onDelete:()=>{t.dismiss(),this.delete.emit()}}});t.present()})}}return e.\u0275fac=function(t){return new(t||e)(l.Jb(o.w))},e.\u0275cmp=l.Db({type:e,selectors:[["app-session-item"]],inputs:{session:"session",selected:"selected"},outputs:{delete:"delete",edit:"edit",save:"save",selectItem:"selectItem"},decls:16,vars:5,consts:[[3,"contextmenu"],["side","start"],["color","primary","icon-only","",3,"click"],["name","create-outline"],["color","secondary","icon-only","",3,"click"],["name","download-outline"],["side","end"],["color","danger","icon-only","",3,"click"],["name","trash-outline"],[3,"color","click"],[4,"ngIf"]],template:function(e,t){1&e&&(l.Mb(0,"ion-item-sliding",0),l.Ub("contextmenu",function(e){return t.onContextmenu(e)}),l.Mb(1,"ion-item-options",1),l.Mb(2,"ion-item-option",2),l.Ub("click",function(){return t.edit.emit(t.session)}),l.Kb(3,"ion-icon",3),l.Lb(),l.Mb(4,"ion-item-option",4),l.Ub("click",function(){return t.save.emit(t.session)}),l.Kb(5,"ion-icon",5),l.Lb(),l.Lb(),l.Mb(6,"ion-item-options",6),l.Mb(7,"ion-item-option",7),l.Ub("click",function(){return t.delete.emit(t.session)}),l.Kb(8,"ion-icon",8),l.Lb(),l.Lb(),l.Mb(9,"ion-item",9),l.Ub("click",function(){return t.selectItem.emit()}),l.Mb(10,"ion-label"),l.Mb(11,"h2"),l.fc(12),l.Lb(),l.Mb(13,"p"),l.fc(14),l.ec(15,v,2,1,"span",10),l.Lb(),l.Lb(),l.Lb(),l.Lb()),2&e&&(l.zb(9),l.Zb("color",t.selected?"primary":void 0),l.zb(3),l.gc(null==t.session?null:t.session.name),l.zb(2),l.ic("",t.device," ",null==t.session?null:t.session.ram,"MB RAM"),l.zb(1),l.Zb("ngIf",null==t.session?null:t.session.osVersion))},directives:[o.k,o.j,o.i,o.g,o.h,o.l,n.i],styles:["ion-label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin-top:.75em}ion-item-option[_ngcontent-%COMP%]{font-size:1.5em}ion-item-sliding[_ngcontent-%COMP%]{cursor:pointer}"]}),e})();function S(e,t){if(1&e){const e=l.Nb();l.Mb(0,"app-session-item",6),l.Ub("delete",function(){l.bc(e);const i=t.$implicit;return l.Wb().deleteSession(i)})("selectItem",function(){l.bc(e);const i=t.$implicit;return l.Wb().launchSession(i)})("edit",function(){l.bc(e);const i=t.$implicit;return l.Wb().editSession(i)}),l.Lb()}if(2&e){const e=t.$implicit,i=l.Wb();let n=null;l.Zb("session",e)("selected",(null==(n=i.emulationService.getCurrentSession())?null:n.id)===e.id)}}const g=[{path:"",component:(()=>{class e{constructor(e,t,i,n,s,o){this.sessionService=e,this.fileService=t,this.alertController=i,this.alertService=n,this.emulationService=s,this.router=o}get sessions(){return this.sessionService.getSessions().sort((e,t)=>e.name.localeCompare(t.name))}deleteSession(e){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"Warning",message:`Deleting the session '${e.name}' will remove all associated data. This cannot be undone. Are you sure you want to continue?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>this.sessionService.deleteSession(e)}]});yield t.present()})}editSession(e){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.queryName(e.name);void 0!==t&&this.sessionService.updateSession(Object.assign(Object.assign({},e),{name:t}))})}loadFile(){this.fileService.openFile(this.processFile.bind(this))}launchSession(e){this.emulationService.switchSession(e.id),this.router.navigateByUrl("/tab/emulation")}processFile(e){return Object(c.a)(this,void 0,void 0,function*(){if(!/\.(img|rom|bin)$/i.test(e.name))return void this.alertService.errorMessage("Unsupported file suffix. Supported suffixes are .bin, .img and .rom.");const t=this.fileService.parseSessionImage(e.content);if(t){const i=yield this.queryName(e.name);void 0!==i&&this.sessionService.addSessionFromImage(t,i)}else{const t=(yield this.emulationService.cloudpilot).getRomInfo(e.content);if(!t)return void this.alertService.errorMessage("Not a valid session file or ROM image.");if(0===t.supportedDevices.length)return void this.alertService.errorMessage("No supported device for this ROM.");const i=yield this.queryName(e.name);void 0!==i&&this.sessionService.addSessionFromRom(e.content,i,t.supportedDevices[0])}})}queryName(e){return new Promise(t=>Object(c.a)(this,void 0,void 0,function*(){(yield this.alertController.create({header:"Session Name",inputs:[{type:"textarea",name:"name",placeholder:"Session name",value:e,label:"Name"}],buttons:[{text:"Cancel",role:"cancel",handler:()=>t(void 0)},{text:"Continue",handler:e=>t(e.name)}]})).present()}))}}return e.\u0275fac=function(t){return new(t||e)(l.Jb(u),l.Jb(b.a),l.Jb(o.a),l.Jb(m.a),l.Jb(a.a),l.Jb(r.g))},e.\u0275cmp=l.Db({type:e,selectors:[["app-sessions"]],decls:14,vars:1,consts:[["slot","primary"],[3,"click"],["name","add-outline"],["collapse","condense"],["size","large"],[3,"session","selected","delete","selectItem","edit",4,"ngFor","ngForOf"],[3,"session","selected","delete","selectItem","edit"]],template:function(e,t){1&e&&(l.Mb(0,"ion-header"),l.Mb(1,"ion-toolbar"),l.Mb(2,"ion-title"),l.fc(3,"Sessions"),l.Lb(),l.Mb(4,"ion-buttons",0),l.Mb(5,"ion-button",1),l.Ub("click",function(){return t.loadFile()}),l.Kb(6,"ion-icon",2),l.Lb(),l.Lb(),l.Lb(),l.Lb(),l.Mb(7,"ion-content"),l.Mb(8,"ion-header",3),l.Mb(9,"ion-toolbar"),l.Mb(10,"ion-title",4),l.fc(11,"Sessions"),l.Lb(),l.Lb(),l.Lb(),l.Mb(12,"ion-list"),l.ec(13,S,1,2,"app-session-item",5),l.Lb(),l.Lb()),2&e&&(l.zb(13),l.Zb("ngForOf",t.sessions))},directives:[o.f,o.s,o.r,o.d,o.c,o.g,o.e,o.m,n.h,f],styles:[""]}),e})()}];let y=(()=>{class e{}return e.\u0275mod=l.Hb({type:e}),e.\u0275inj=l.Gb({factory:function(t){return new(t||e)},imports:[[r.i.forChild(g)],r.i]}),e})(),M=(()=>{class e{}return e.\u0275mod=l.Hb({type:e}),e.\u0275inj=l.Gb({factory:function(t){return new(t||e)},imports:[[n.b,s.a,o.t,y]]}),e})()}}]);